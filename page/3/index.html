<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"alan20210202.github.io","root":"/","images":"/images","scheme":"Mist","version":"8.2.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>
<meta name="description" content="不务正业高中生一枚">
<meta property="og:type" content="website">
<meta property="og:title" content="Chengyuan Ma&#39;s Blog">
<meta property="og:url" content="https://alan20210202.github.io/page/3/index.html">
<meta property="og:site_name" content="Chengyuan Ma&#39;s Blog">
<meta property="og:description" content="不务正业高中生一枚">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Chengyuan Ma">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://alan20210202.github.io/page/3/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>
<title>Chengyuan Ma's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-65HSG5NCY6"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-65HSG5NCY6');
      }
    </script>




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Chengyuan Ma's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-pagedewarp"><a href="/dewarp/" rel="section"><i class="fa fa-sticky-note fa-fw"></i>PageDewarp</a></li>
        <li class="menu-item menu-item-english"><a href="/english/" rel="section"><i class="fa fa-globe-americas fa-fw"></i>English</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Chengyuan Ma</p>
  <div class="site-description" itemprop="description">不务正业高中生一枚</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">86</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      友情链接
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://kalasearch.cn/" title="https:&#x2F;&#x2F;kalasearch.cn&#x2F;" rel="noopener" target="_blank">卡拉搜索</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2020/07/02/Sublinear/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/07/02/Sublinear/" class="post-title-link" itemprop="url">次线性算法与有序判定问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-07-02 17:04:15" itemprop="dateCreated datePublished" datetime="2020-07-02T17:04:15+08:00">2020-07-02</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-07-12 11:17:55" itemprop="dateModified" datetime="2020-07-12T11:17:55+08:00">2020-07-12</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="什么是次线性算法？"><a href="#什么是次线性算法？" class="headerlink" title="什么是次线性算法？"></a>什么是次线性算法？</h1><p>如何衡量算法的效率？一般来说，问题（以及对应的算法）可以分为以下几类：</p>
<ol>
<li>不可判定问题。这种问题不存在算法。</li>
<li>指数时间可解。这种问题虽然存在算法但是就目前我们的技术水平，对于大输入，它们没办法在可接受的时间内返回结果。</li>
<li>多项式时间可解。这些算法可以在现在的电脑上较为高效地运行。</li>
<li>线性时间可解。这是大多数人认为的最高效算法，一般来说不会有比这更高效的了（读取输入就是线性的，不读完输入怎么计算输出？）</li>
<li><strong>次线性时间算法</strong>。“次线性”(sublinear)即“线性以下”，指在利用低于与输入线性的资源（可以是时间也可以是空间）的情况下解决问题的一类算法。这类算法有着非常不可思议的特性：它甚至都不会看完完整的输入！</li>
</ol>
<p>为什么我们需要次线性算法？</p>
<p>大数据时代我们要处理的数据是在是太多了，光是谷歌一天就会产生20PB的数据，我们根本没有足够的时空资源来哪怕运行线性的算法或者把它们全部过一遍！但是我们又希望从这些数据中挖掘有价值的结论，就只能求助于次线性算法了。</p>
<p>因为次线性算法没法看到完整的输入，给出错误的结果自然是情有可原的（在精确解没法在次线性时间内算出的情况下）。因此，次线性算法多是<strong>近似算法</strong>。同时，因为如果一个算法是确定性的，对手就可以预判这个算法会看那部分输入，并针对这个造出会让算法100%翻车的数据，因此<strong>随机化</strong>在次线性算法的设计也经常出现。</p>
<h1 id="查询模型"><a href="#查询模型" class="headerlink" title="查询模型"></a>查询模型</h1><p>好，既然次线性算法不能把输入完整地读一遍，那么要怎么样才能获取输入的信息呢？我们将次线性算法获取输入信息的方式称为<strong>查询</strong>（query）。而算法的难易自然和可以进行的查询方式有着很大的关系，因此我们还需要一组规则定义在一个问题中可以进行何种方式的查询，这种规则称一个问题的<strong>查询模型</strong>（query model）。例如，在以数组为输入的问题当中，常见的查询方式是按照一个下标询问对应的值，在以图为输入的问题当中，查询可以是按照两点查询边权……可以看到，查询模型是因问题而异的。</p>
<h1 id="有序判定问题（Sortedness-Problem）"><a href="#有序判定问题（Sortedness-Problem）" class="headerlink" title="有序判定问题（Sortedness Problem）"></a>有序判定问题（Sortedness Problem）</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p><strong>输入：</strong>一个$n$个元素的数组$A$。</p>
<p><strong>查询模型：</strong>对于一个整数$1\le i \le n$，查询$A_i$的值。</p>
<p><strong>目标：</strong>在尽量少的时间内（假设一次查询时$\mathcal{O}(1)$的）<strong>判断这个数组是否是有序</strong>（此处单指<strong>升序</strong>）的。</p>
<p>很显然，任何一个确定性的算法都必须进行$\Omega(n)$次查询才能解决这个问题（不然肯定会有漏看的）。</p>
<p>因此我们退而求其次：如果运用随机化的话，我们能不能在$o(n)$次查询之内给出正确概率至少为$\frac{1}{2}+\epsilon\ (\epsilon &gt;0)$的答案呢？</p>
<p>（正确概率在这里只要大于$\frac{1}{2}$就行，精确的值没有意义，因为我们总是可以重复运行不靠谱的算法提高正确率）</p>
<p>答案还是不行（证明课上似乎没讲？）</p>
<p>那我们怎么办？只好稍微把题目修改一下，再退而求其次看看能不能有高效的<strong>近似算法</strong>了。</p>
<h2 id="修改后的定义"><a href="#修改后的定义" class="headerlink" title="修改后的定义"></a>修改后的定义</h2><p>我们不妨寻找这么一个算法，它</p>
<ol>
<li>在数组有序的时候输出是</li>
<li>在数组“非常无序”的时候输出否</li>
<li>而对于那种非常接近有序的数组，我们干脆不管。</li>
</ol>
<p>设计这样的算法显然比设计能够精确解决这个问题的算法要容易多了。</p>
<p>那么怎么样算是“非常无序”，怎么样算是“接近有序”呢？显然，我们需要在数学上给予这些描述严谨的定义。</p>
<p><strong>定义：</strong>对于$\epsilon\in(0,1)$，如果需要至少修改$\epsilon n$个数才能让数组$A$变为有序，那么称数组$A$是$\epsilon$无序（$\epsilon$-far from sorted）的。</p>
<p>那么我们就可以进一步精炼我们上面的问题了：我们需要设计一个算法，使其</p>
<ol>
<li>在$A$有序的时候输出是</li>
<li>在$A$ $\epsilon$无序的时候输出否</li>
</ol>
<p>（$\epsilon$是算法的一个参数）</p>
<p>从这里其实可以看到对于近似算法的一种设计思路：对于数值型的问题，我们通过对于最优解的放缩定义了近似比$\alpha$，而对于判定型的问题，我们试图放宽需要判定的条件。在上面的问题当中我们相当于变相假设，或者说承诺了$A$要么是有序要么是$\epsilon$无序的，因此这种问题被称作promise problem。</p>
<h2 id="二元数组"><a href="#二元数组" class="headerlink" title="二元数组"></a>二元数组</h2><p>我们先从最简单的情形开始分析：如果数组只有$0$和$1$两种元素呢？</p>
<h3 id="初步分析"><a href="#初步分析" class="headerlink" title="初步分析"></a>初步分析</h3><p>显然此时数组有序等价于所有的$0$都在$1$前面。</p>
<p>我们不妨定义两个集合，$L_1$和$R_0$。如果将数组里的元素从左到右排列，$L_1$表示最靠左的$\frac{\epsilon n}{2}$个$1$的下标集合，$R_0$表示最靠右的$\frac{\epsilon n}{2}$个$0$的下标集合。</p>
<p>显然在数组有序时，$L_1$整体都在$R_0$右边。而当数组不有序时，有可能：</p>
<ol>
<li>$L_1$和$R_0$的区间重叠。</li>
<li>$L_1$在$R_0$的左边。</li>
</ol>
<p>接下来我们证明：</p>
<p><strong>引理：</strong>如果$A$是$\epsilon$无序的，那么$L_1$必定在$R_0$左边且不重叠。</p>
<p><strong>证明：</strong>我们使用反证法，不妨假设$L_1$和$R_0$有重叠的部分：<br>$$<br>0,0,\cdots,\rlap{\overbrace{1,\cdots,1,0,1}^{L_1} }1,\cdots,1,\underbrace{ {\color{blue}{0} },{\color{red}{1} },0,\cdots,0}_{R_0},\cdots1,1<br>$$</p>
<p>$\color{red}1$是$L_1$中最右边的$1$，$\color{blue}0$是$R_0$中最左边的$0$。</p>
<p>由$L_1,R_0$的定义可知，$\color{red}1$左侧的$1$的数量严格小于$\frac{\epsilon n}{2}$，$\color{blue}0$右侧的$0$的数量也严格小于$\frac{\epsilon n}{2}$。而注意到如果把$\color{red}1$的左侧$1$改成$0$，把$\color{blue}0$右侧的$0$的改成$1$，那么数组就变得有序了，而此时我们修改的元素数量严格小于$\epsilon n$，这和数组是$\epsilon$无序的前提是矛盾的。</p>
<h3 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h3><p>接下来我们给出能够以$1-\delta$的成功率判定二元数组有序性的算法：</p>
<ol>
<li>从数组当中随机选取$t=\frac{2}{\epsilon}\ln\frac{2}{\delta}$个下标$i_1,\cdots,i_t$（为了简化分析，允许下标重复）。</li>
<li>查询$A_{i_1},\cdots, A_{i_t}$的值。</li>
<li>如果在$\left{A_{i_1},\cdots, A_{i_t}\right}$当中发现了逆序对，输出否，否则输出是。</li>
</ol>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>很显然，如果数组是有序的，那么我们的算法一定会输出是，成功率$1&gt;1-\delta$。</p>
<p>而如果数组是$\epsilon$-无序的，为了证明此时的成功率至少为$1-\delta$，我们只需要证明<br>$$<br>\operatorname{Pr}[\text{wrong answer}] \le \delta<br>$$<br>即错误（输出了是）概率不大于$\delta$。</p>
<p>设随机事件$E_L$表示在随机选取的$t$个下标中，至少有一个下标来自$L_1$，$E_R$表示至少有一个下标来自$R_0$。</p>
<p>那么由之前的引理，如果$E_L\cap E_R$，我们一定找得到逆序对。</p>
<p>因此只有可能在$\overline{E_L\cap E_R}$才有可能出错：<br>$$<br>\begin{aligned}<br>    \operatorname{Pr}[\text{wrong answer}] \le \operatorname{Pr}\left[\overline{E_L}\cup\overline{E_R} \right] \le \operatorname{Pr}\left[\overline{E_L}\right] +  \operatorname{Pr}\left[\overline{E_R}\right]<br>\end{aligned}<br>$$<br>而<br>$$<br>\begin{aligned}<br>    \operatorname{Pr}\left[\overline{E_L}\right] &amp;= \left(1-\frac{\left|L_1\right|}{n}\right) ^ t \<br>    &amp;= \left(1-\frac{\epsilon}{2}\right)^{\frac{2}{\epsilon}\ln\frac{2}{\delta}} \<br>    &amp;\le \left(e^{-\frac{\epsilon}{2}}\right)^{\frac{2}{\epsilon}\ln\frac{2}{\delta}} \<br>    &amp;= \frac{\delta}{2}<br>\end{aligned}<br>$$<br>倒数第二步我们运用了不等式$1+x\le e^x$。</p>
<p>同理可证$\operatorname{Pr}\left[\overline{E_R}\right] \le \frac{\delta}{2}$，因此<br>$$<br>\operatorname{Pr}[\text{wrong answer}] \le \operatorname{Pr}\left[\overline{E_L}\right] +  \operatorname{Pr}\left[\overline{E_R}\right] \le \frac{\delta}{2} + \frac{\delta}{2} = \delta<br>$$<br>证毕。</p>
<h3 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h3><p>随机采样花费的时间复杂度为$\mathcal{O}(t)$。</p>
<p>查询子数组花费的时间复杂度也是$\mathcal{O}(t)$。</p>
<p>而在子数组当中查找逆序对也可以被优化成$\mathcal{O}(t)$，实现的方法有很多，例如可以计算$1$的下标的最小值和$0$的下标的最大值进行比较等。</p>
<p>因此这个算法的时间复杂度就是$\mathcal O(t) = \mathcal O\left(\frac{1}{\epsilon}\ln\frac{1}{\delta}\right)$，和$n$无关。</p>
<h2 id="一般情况"><a href="#一般情况" class="headerlink" title="一般情况"></a>一般情况</h2><p>接下来我们来看数组元素可以是任意数字的情况。</p>
<p>我们之前随机采样的想法还能继续沿用吗？</p>
<p>考虑如下情况：<br>$$<br>3,2,1{\color{red}|}6,5,4{\color{red}|}9,8,7<br>$$<br>虽然这个数组是$\frac{2}{3}$无序的，但是如果我的随机采样在每个段中只挑了一个元素，那采样出来的子序列却一定是有序的，我们的算法就被糊弄过去了。</p>
<p>这就是问题所在：如果我们把一个数组分成若干段“总体有序，但局部无序”的连续段，显然这样的段最多可以有$\mathcal O(n)$个。而为了能够在子序列当中找到逆序对，就必须从同一个段当中至少选两个数。而由生日悖论可知，为了大概率确保能从一个段中选两个数，我们必须至少随机选$\mathcal O\left(\sqrt n\right)$个数——这让我们之前的分析几乎废掉。</p>
<p>那怎么办呢？</p>
<p>考虑一个有序的数组所具有的性质。在算法层面，一个熟悉的性质便是：<strong>可以进行二分查找</strong>。</p>
<p>这给我们一个思路：如果我们不管三七二十一在给定的数组上跑二分，如果二分翻车了，那么数组一定是无序的，如果二分没翻车，数组或许就是有序的。</p>
<p>如何定义二分有没有“翻车”？或者说，如何定义一次正常的二分？</p>
<p>引入<em>一致二分查找</em>（Consistent Binary Search）的概念，如果对于一次二分查找，</p>
<ol>
<li>我最后找到了我要找的那个数（也就是说，如果我要找的是$A_i$，而我的二分最后终止于下标$i$），</li>
<li>假设二分的左右端点和终点分别为$l,r,m$，二分的过程中$A_l &lt; A_m &lt; A_r$始终成立，</li>
</ol>
<p>那么我们称这次二分查找是“一致的”或“相容的”（我觉得翻译成哪个似乎都不大合适）。</p>
<h3 id="算法-1"><a href="#算法-1" class="headerlink" title="算法"></a>算法</h3><p>在二分思想的指引下我们提出如下的算法：</p>
<ol>
<li>随机选择一个下标$i$并查询$A_i$的值。</li>
<li>二分查找$A_i$。</li>
<li>如果这次二分查找是一致的，那么输出是，反之输出否。</li>
</ol>
<h3 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h3><p><strong>引理：</strong>如果对于$A_i$和$A_j$的二分查找都是一致的，而且$i&lt;j$，一定有$A_i&lt;A_j$。</p>
<p><strong>证明：</strong>虽然两次二分查找中前几层的搜索区间可能相同，但由于$i &lt; j$，到了某一层一定会出现$A_i$往左边，$A_j$往右边的分歧。假设该层搜索区间的中点是$A_m$，显然对$A_i$的二分搜索之所以在这层之后往左走是因为$A_i &lt; A_m$，同理可知$A_j&gt;A_m$，将二式组合引理便得证。</p>
<p>假设$C$表示所有对下标对应的数进行的二分搜索是一致的下标的集合。则由刚刚的引理，由$C$中下标组成的原数组的子序列一定是有序的。因为原数组是$\epsilon$无序的，因此必然有$|C|&lt;(1-\epsilon) n$（可以通过反证法证明）。</p>
<p>这个结论有什么意义呢？要知道我们的算法在原数组有序的时候一定输出正确的结果，而在原数组无序时，我们算法只有在抽到$C$中的下标时才会做出误判。因此我们算法的错误率的上界为$1-\epsilon$。</p>
<p>在得出这个上界之后，我们就可以改进我们的算法了：</p>
<ol>
<li>将之前的算法运行$k=\frac{1}{\epsilon}\ln\frac{1}{\delta}$遍。</li>
<li>如果$k$次运行的结果都为是，则输出是，反之则输出否。</li>
</ol>
<p>这样的错误率是多少呢？<br>$$<br>\begin{aligned}<br>    \operatorname{Pr}[\text{wrong answer}] &amp;\le \left(1-\epsilon\right)^k \<br>    &amp;= \left(1-\epsilon\right)^{\frac{1}{\epsilon}\ln\frac{1}{\delta}} \<br>    &amp;\le \left(e^{-\epsilon}\right)^{\frac{1}{\epsilon}\ln\frac{1}{\delta}} \<br>    &amp; = \delta<br>\end{aligned}<br>$$<br>因此正确率至少为$1-\delta$，符合我们的要求。而这个算法的时间复杂度是$\mathcal O\left(\frac{1}{\epsilon}\ln\frac{1}{\delta}\log n\right)$，也是相当优秀的。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2020/07/02/PACT0701/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/07/02/PACT0701/" class="post-title-link" itemprop="url">PACT 07/01 任务调度问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-07-02 14:46:30" itemprop="dateCreated datePublished" datetime="2020-07-02T14:46:30+08:00">2020-07-02</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-07-04 15:23:24" itemprop="dateModified" datetime="2020-07-04T15:23:24+08:00">2020-07-04</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><p><strong>输入：</strong>$n$个任务，第$i$个任务的运行时间为$p_i$，共有$m$个相同的机器（一个任务在每台机器上运行时间都相同）。每台机器同一时间只能运行一个任务，每个任务只能在一台机器上运行（不能拆分）。</p>
<p><strong>目标：</strong>合理地调度任务，使得完成所有任务的时间（makespan）最短。</p>
<h1 id="下界估计"><a href="#下界估计" class="headerlink" title="下界估计"></a>下界估计</h1><p>自然而然地，我们首先思考$\mathrm{OPT}$的下界。一个比较容易想到的下界是耗时最长的任务所需要的时间：<br>$$<br>\mathrm{OPT} \ge \max_{i} {p_i}<br>$$<br>除此以外，考虑如果可以拆分任务，最短的运行时间是多少？自然是$\frac{\sum_i p_i}{m}$，而这在现实中常常是做不到的，因此有：<br>$$<br>\mathrm{OPT} \ge \frac{\sum_i p_i}{m}<br>$$<br>这两个下界对于之后的算法分析非常有用。</p>
<h1 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h1><ol>
<li>将所有的任务随机排成一列。</li>
<li>当一台机器完成了一个任务变得闲置了，马上把列表上的下一项任务安排到这个机器上去执行。</li>
<li>重复步骤2直至所有任务都被执行完毕。</li>
</ol>
<p>这个算法是非常简单且自然的。</p>
<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>我们算法给出结果的什么？自然是最后一个结束的任务的结束时间。如果我们设最后一个结束的任务为任务$l$，且这个任务开始于$s_l$，那么就有：<br>$$<br>\mathrm{Cost} = s_l+p_l<br>$$<br>接下来我们进行放缩。</p>
<p>考虑$s_l$的上界是什么？</p>
<p><img src="./SIPM1.svg"></p>
<p>很显然，<strong>在$s_l$时刻，除了$l$即将运行的那台机器，其他机器上必须有任务在运行或者刚刚空下来</strong>（如果有机器已经空了一阵子了，那当时$l$就会被安排到那台机器上去跑），因此不难得出$ms_l \le \sum_{i\neq l} p_i$，即<br>$$<br>s_l \le \frac{\sum_{i \neq l}p_i}{m}<br>$$<br>因此<br>$$<br>\begin{aligned}<br>\mathrm{Cost} &amp;= s_l+p_l \<br>&amp; \le \frac{\sum_{i \neq l}p_i}{m} + p_l \<br>&amp;= \frac{\sum_{i}p_i}{m} + \left(1 - \frac{1}{m}\right) p_l \<br>&amp;\le \frac{\sum_{i}p_i}{m} + \left(1 - \frac{1}{m}\right)\max_{i}{p_i} \<br>&amp;\le \mathrm{OPT} + \left(1 - \frac{1}{m}\right)\mathrm{OPT} \<br>&amp;= \left(2 - \frac{1}{m}\right)\mathrm{OPT}<br>\end{aligned}<br>$$<br>我们就证明了我们的算法是一个$2$倍近似算法！</p>
<h1 id="提升近似比"><a href="#提升近似比" class="headerlink" title="提升近似比"></a>提升近似比</h1><p>能不能在这个算法的基础上提升呢？我们注意到将$\mathrm{OPT}$作为$p_l$的上界其实还是太松了。如果我们能够缩短$p_l$，那上界的估计有没有改善的空间呢？</p>
<p>于是我们在原来算法的基础上不妨进行一个改进：与其在一开始将所有任务随机排列，不如<strong>将其按照运行时间从大到小的顺序进行排序</strong>。这也很符合直觉，一开始就把需要时间很长的任务跑完，之后肯定有些机器空着有些机器还在忙，这个时候就可以用完成时间比较短的小任务来灵活地填补这些空缺了。</p>
<p>这一下让近似比提升了多少呢？</p>
<p><strong>引理：</strong>加上排序之后的算法具有$\frac{3}{2}$的近似比。</p>
<p><strong>证明：</strong>我们不妨分类讨论，</p>
<p>**情形1. **$p_l \le \frac{1}{2}\mathrm{OPT}$，这个时候按照我们上文分析的路子走直接就可以得到$\mathrm{Cost} \le \frac{3}{2}\mathrm{OPT}$，就做完了。</p>
<p><strong>情形2. <strong>$p_l &gt; \frac{1}{2}\mathrm{OPT}$，此时所有$l$之前的任务也肯定具有大于$\frac{1}{2} \mathrm{OPT}$的运行时间。注意到</strong>我们不需要考虑$p_l$之后的任务</strong>，因为依据定义$l$是最后结束的，后面的任务对于我们的结果没有影响。那$l$之前的任务在最优调度里面是怎么样的呢？反证法可以很快说明：<strong>在最优调度里面，每一台机器至多只能处理一件任务</strong>（忽略$l$之后的任务）！也就是说事实上$l$以及之前的任务数目加起来不会超过机器数$m$，那再想一想在这种机器充足的情况下，我们的算法在分配这些任务的时候也是一个机器一个任务，$p_l$必定是从一开始就执行的，因此$\mathrm{Cost}=p_l$，而显然$\mathrm{OPT} \ge p_l$，因此必有$\mathrm{Cost} = \mathrm{OPT}$，结束。（事实上，由于$l$还是最后结束的任务，不难想通在一机器一任务的情形下，$l$之前的所有任务都一定和$l$花费相同的时间，或$l$就是我们算法分配的第一个任务。）</p>
<p>综上所述，近似比是$\frac{3}{2}$。</p>
<h1 id="进一步提升近似比"><a href="#进一步提升近似比" class="headerlink" title="进一步提升近似比"></a>进一步提升近似比</h1><p>通过对于上述论证的些许修改，我们其实可以证明：</p>
<p><strong>引理：</strong>加上排序之后的算法具有$\frac{4}{3}$的近似比。</p>
<p><strong>证明：</strong>我们故技重施：</p>
<p>**情形1. **$p_l \le \frac{1}{3}\mathrm{OPT}$，这个时候我们直接就可以得到$\mathrm{Cost} \le \frac{4}{3}\mathrm{OPT}$。</p>
<p><strong>情形2. <strong>$p_l &gt; \frac{1}{3}\mathrm{OPT}$，此时所有$l$之前的任务也肯定具有大于$\frac{1}{3} \mathrm{OPT}$的运行时间。我们同样不考虑$l$之后的任务。可以通过反证证明：</strong>在最优调度里，每一台机器至多只能处理两件任务！</strong>因此，我们确定有足够的机器让我们的算法得以这样调度任务：</p>
<p><img src="./SIPM2.svg"></p>
<p>（看着是不是很像双指针？）</p>
<p>具体来说，如果我们把机器按照第一个任务的耗时降序排序，那么它们第二个任务的耗时一定成升序排列。（这并不难证明：第一个任务耗时最短的机器一定能够先领到列表中最长的任务作为第二个任务，之后的机器领到的任务时间递减）</p>
<p>（在这里我们假定$l$一定是第二个任务，如果$l$从头开始运行而且时间特别长的话，参考上一节的证明）</p>
<p>而接下来我们证明这样的分配方式是最优的。</p>
<p>我们采取反证的方法：不妨假设在最优方案中存在两个机器，两个机器上都有两个任务，耗时分别为$(a,b)$和$(c,d)$，且$a&gt;c,b&gt;d$。那么我们把两个机器上的第二个任务互换，变成$(a,d)$和$(c,b)$，不难发现此时完成任务的最短时间会减少，和“最优”矛盾。因此，对于最优方案的任意两台机器$(a,b)$和$(c,d)$，如果$a&gt;c$那么$b&lt;d$：</p>
<p><img src="./SIPM3.svg"></p>
<p>这正是我们算法所给出的调度方案。因此$\mathrm{OPT}$不会比我们算法的结果更好了。</p>
<p>综上所述，近似比为$\frac{4}{3}$。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2020/07/01/PACT0630/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/07/01/PACT0630/" class="post-title-link" itemprop="url">PACT 06/30 $k$中心问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-07-01 13:26:53" itemprop="dateCreated datePublished" datetime="2020-07-01T13:26:53+08:00">2020-07-01</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-07-12 11:17:27" itemprop="dateModified" datetime="2020-07-12T11:17:27+08:00">2020-07-12</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h1><p>定义所谓$k$中心问题为：</p>
<p><strong>输入：</strong>完全图$G=(V,E)$，边带正权，且满足三角不等式$w_{uv} \le w_{uk} + w_{kv}$，以及一个正整数$k$。</p>
<p><strong>目标：</strong>求一个点集$|S|=k$（称为$k$个中心），定义一个点到一个点集的距离<br>$$<br>d(u,S) = \min_{v\in S} w_{uv}<br>$$<br>（显然，如果满足三角不等式，那么任意两点之间的最短距离就是直接连接两点的边权）</p>
<p>要求最小化$\max_{u\in V} d(u,S)$。即所有顶点到这$k$个中心的<strong>最短路程的最大值</strong>（不妨称之为这个这个$k$中心的<strong>代价</strong>）最小。</p>
<h1 id="近似算法1（Gonzalez）"><a href="#近似算法1（Gonzalez）" class="headerlink" title="近似算法1（Gonzalez）"></a>近似算法1（Gonzalez）</h1><h2 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h2><ol>
<li>任意选取一个顶点并将其加入$S$。</li>
<li>选取离当前$S$最远的顶点加入$S$。</li>
<li>重复步骤2直至$|S|=k$。</li>
</ol>
<p>第2步的操作是非常合乎直觉的：如果不把离$S$最远的顶点加入$S$的话，这条最远的边权就可能会被计入答案当中，这显然是不合算的，而如果将这个最远点作为新的中心，那么这条最远边就必定不会被计入答案。</p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>这个算法给出方案的代价是什么？在这个算法的背景下，我们不妨说：<em>这个算法结果的代价是如果不跳出循环，下一个选取的中心到当前$S$的距离</em>（依据第2步）。假设这个中心为$x$，我们不妨画图：</p>
<p><img src="./Analysis1.jpg"></p>
<p>其中左边的$S$是我们的解，右边是最优解（我们这里把他们化成了不重叠的形式，事实上有重叠对于我们的论证也不造成影响）。</p>
<p>我们的解加上$x$总共有$k+1$个点，最优解有$k$个点，因此由抽屉原理，至少左边有两个点，它们在最优解中的最近点是相同的（即图中的两条横叉边），且由于是最优解，两条边的长度都$\le \mathrm{OPT}$。</p>
<p>不妨设这两个点为$u,v$，由三角不等式，可以得出$w_{uv}\le2\cdot\mathrm{OPT}$。</p>
<p>接下来不妨假设$u,v$中的后来者为$v$，为什么当时我们选择$v$而不是$x$加入$S$呢？肯定是因为当时$d(v,S)\ge d(x,S)$。而由$d(v,S)$的定义可知，$d(v,S)\le w_{uv}$，且由于随着$S$的变大，$d(x,S)$不增，因此我们解的代价（即现在的$d(x,S)$）一定也是不大于当时的$d(v,S)$。将这些不等式串联起来，便得到：<br>$$<br>d(x,S) \le w_{uv} \le 2\cdot \mathrm{OPT}<br>$$<br>也就是说这个算法的近似比为$2$。</p>
<h1 id="近似算法2（Hochbaum-amp-Shmoys）"><a href="#近似算法2（Hochbaum-amp-Shmoys）" class="headerlink" title="近似算法2（Hochbaum &amp; Shmoys）"></a>近似算法2（Hochbaum &amp; Shmoys）</h1><h2 id="算法-1"><a href="#算法-1" class="headerlink" title="算法"></a>算法</h2><p>我们不妨<strong>假设我们已经知道了最优解的代价</strong>$\mathrm{OPT}$，那么我们要怎么做呢？</p>
<ol>
<li>我们选取任意顶点$u_1$加入中心，并以为中心画一个半径为的球，钦定球内的所有点归$u_1$。</li>
<li>我们接着选取一个在这个球以外的一个顶点$u_2$加入中心，并以$u_2$为中心画一个半径为$2\cdot \mathrm{OPT}$的球，钦定球里面的点归$u_2$。</li>
<li>我们接着选取一个在$u_1$和$u_2$的球外的点$u_3$作为中心……</li>
<li>重复上述步骤，直至图上的所有点都归一个至多$2\cdot \mathrm{OPT}$远处的中心管。</li>
</ol>
<p>画在图上大概是这样的：</p>
<p><img src="./HS.jpg"></p>
<p>可以看到，可能会有点同时处在多个中心的“势力范围”之内，但这并不重要，我们只需要确保每个点离最近的一个中心至多$2\cdot \mathrm{OPT}$那么远就行了。</p>
<h2 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h2><p>我们接下来证明这是一个$2$近似算法。算法本身的流程确保了$2$的近似比，因此唯一需要证明的就是这个算法产生的中心不超过要求的$k$个。</p>
<p>不妨反证：如果产生了超过$k$个中心呢？</p>
<p><img src="./Analysis2.jpg"></p>
<p>那么根据抽屉原理，至少有两个中心在最优解中的最近点是相同的（这和我们分析第一个算法时的逻辑是完全相同的），由三角不等式，这两个中心之间的距离$\le 2\cdot \mathrm{OPT}$。但是根据算法，中心之间两两距离应该大于$2\cdot \mathrm{OPT}$，这就产生了矛盾。</p>
<p>因此必定不会有超过$k$个中心，证毕。</p>
<p>还剩下来一个问题：这个算法假定我们知道$\mathrm{OPT}$，但是实际上我们不知道啊！</p>
<p>但是我们知道$\mathrm{OPT}$<em>一定是某一条边的边权</em>，因此我们只需要按边权从小到大<strong>枚举每一条边，把边权当做$\mathrm{OPT}$试试看</strong>，如果产生超过$k$个中心那必然不是$\mathrm{OPT}$（这是我们推论的逆否），而反之则可能就是$\mathrm{OPT}$（但无论如何，事实上是$\mathrm{OPT}$的那条边一定是没有问题的）。因为我们在这里只在意是否是多项式时间复杂度而不在意复杂度本身，而枚举边自然是多项式时间的，因此没有任何问题（当然，在实现过程中可以考虑使用二分，但这就是后话了）。</p>
<h1 id="近似比可以更好吗？"><a href="#近似比可以更好吗？" class="headerlink" title="近似比可以更好吗？"></a>近似比可以更好吗？</h1><p><strong>定理：</strong>如果存在一个多项式时间的，近似比$&lt;2$的$k$中心问题的近似算法，那么$\mathsf{P}=\mathsf{NP}$。</p>
<p><strong>证明：</strong>考虑<em>最小支配集问题</em>的判定形式：</p>
<p><strong>输入：</strong>无向图$G=(V,E)$以及正整数$k$。</p>
<p><strong>判定：</strong>是否存在一个大小为$k$的支配集？支配集定义为一个点集$S\subseteq V$，使得$\forall u\in V$，要么$u\in S$或者$u$的邻居$\in S$。</p>
<p>最小支配集问题是NPC的。我们接下来将其规约到$k$中心问题（也是判定形式）：</p>
<p><strong>输入：</strong>完全图$G’$，正整数$k,b$。</p>
<p><strong>判定：</strong>是否存在一个代价$\le b$的$k$中心的方案？</p>
<p>如何规约？不难想到，我们可以让$G$与$G’$用相同的点集，而对于所有在$G$中的边，其在$G’$中的边权为$1$。而对于所有不在$G$中的边，其在$G’$中的边权为$2$（为什么是$2$？直觉上我们会首先想到$\infty$，但是这样就不满足三角不等式了，因此改成$2$）。令两个问题当中的$k$相等，且$b=1$，我们就完成了规约。</p>
<p>为什么？</p>
<p>在这样的规约下，一个在$G$中的支配集必然对应一个$G’$当中代价为$1$的相同大小的$k$中心，反之亦然。</p>
<p>也就是说，如果我们可以解决这个规约后的$k$中心问题，那么我们就能解决原来的最小支配集问题了。</p>
<p>这个时候就可以看出为什么近似比$&lt;2$的近似算法牛逼了：</p>
<ol>
<li>如果$G$当中有符合要求的支配集，那么$k$中心的$\mathrm{OPT}=1$，而由于近似比$&lt;2$且边权只有$1,2$，因此即使是近似算法也会次次给出$1$。</li>
<li>如果$G$当中没有符合要求的支配集，那么$k$中心的$\mathrm{OPT} = 2$，而由于近似比$&lt;2$且边权只有$1,2$，因此即使是近似算法也只能给出$2$。</li>
</ol>
<p>如此说来，即使是近似算法，通过判断输出代价是$1$还是$2$我们就能判断$G$中有没有大小$k$的支配集。而这个近似算法是多项式时间的，因此我们可以用多项式时间解决支配集问题这么一个NPC问题，即$P=NP$。</p>
<p>刚刚用到的这个技巧被称为“gap reduction”。</p>
<p>整个定理的言下之意就是如果你也相信$\mathsf{P}\neq \mathsf{NP}$，那么就可以洗洗睡了~</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2020/06/30/PACT0629/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/30/PACT0629/" class="post-title-link" itemprop="url">PACT 06/29 三大概率不等式以及近似算法初步</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-30 21:22:22" itemprop="dateCreated datePublished" datetime="2020-06-30T21:22:22+08:00">2020-06-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-07-12 11:17:08" itemprop="dateModified" datetime="2020-07-12T11:17:08+08:00">2020-07-12</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="概率论初步"><a href="#概率论初步" class="headerlink" title="概率论初步"></a>概率论初步</h1><h2 id="期望的线性性"><a href="#期望的线性性" class="headerlink" title="期望的线性性"></a>期望的线性性</h2><p>$$<br>\mathbb{E}[X+Y] = \mathbb E [X] + \mathbb E[Y]<br>$$</p>
<h2 id="随机变量的方差"><a href="#随机变量的方差" class="headerlink" title="随机变量的方差"></a>随机变量的方差</h2><p>$$<br>\begin{aligned}<br>    \operatorname{Var}[X] &amp;:= \mathbb{E}\left[\left(X-\mathbb{E}[X]\right)^2\right] \<br>    &amp;= \mathbb{E} \left[X^2 - 2\mathbb{E}[X]X+\mathbb{E}[X]^2\right] \<br>    &amp;= \mathbb{E} \left[X^2\right] - 2\mathbb{E}[X]^2 + \mathbb{E}[X]^2 \<br>    &amp;= \mathbb{E} \left[X^2\right] - \mathbb{E}[X]^2<br>\end{aligned}<br>$$</p>
<p><strong>推论：</strong>若随机变量$X,Y$互相独立，则有：</p>
<ol>
<li>$\operatorname{Var}[X+Y] = \operatorname{Var}[X] + \operatorname{Var}[Y]$</li>
<li>$\mathbb{E}[XY] = \mathbb{E}[X]\mathbb{E}[Y]$</li>
</ol>
<p>（互相独立的定义：$\forall x, y, \operatorname{Pr}[X=x\cap Y=y]=\operatorname{Pr}[X=x]\operatorname{Pr}[Y=y]$）</p>
<h2 id="马尔科夫不等式"><a href="#马尔科夫不等式" class="headerlink" title="马尔科夫不等式"></a>马尔科夫不等式</h2><p>设$X$为<strong>非负</strong>随机变量，则$\forall a &gt;0$：<br>$$<br>\operatorname{Pr}[X\ge a] \le \frac{\mathbb{E}[X]}{a}<br>$$<br><strong>证明：</strong><br>$$<br>\begin{aligned}<br>    \mathbb{E}[X] &amp;= \sum_{x}x\operatorname{Pr}[X=x] \<br>    &amp;= \sum_{x&lt;a}x\operatorname{Pr}[X=x] + \sum_{x\ge a}x\operatorname{Pr}[X=x] \<br>    &amp;\ge \sum_{x\ge a}x\operatorname{Pr}[X=x] \<br>    &amp;\ge \sum_{x\ge a}a\operatorname{Pr}[X=x] \<br>    &amp;= a \sum_{x\ge a}\operatorname{Pr}[X=x] \<br>    &amp;= a \operatorname{Pr}[X\ge x]<br>\end{aligned}<br>$$<br>（离散形式，连续形式的证明方法类似）</p>
<p>其中第一个$\ge$依赖于$X$非负的特性，因此非负是必须的！</p>
<p>马尔科夫不等式让我们可以在只知道随机变量期望的情况下对于其分布概率进行粗略定界。</p>
<h2 id="切比雪夫不等式"><a href="#切比雪夫不等式" class="headerlink" title="切比雪夫不等式"></a>切比雪夫不等式</h2><p>设$X$为随机变量，则$\forall a &gt; 0$：<br>$$<br>\operatorname{Pr}\left[|X-\mathbb{E}[X]| \ge a\right] \le \frac{\operatorname{Var}[X]}{a^2}<br>$$<br><strong>证明：</strong><br>$$<br>\begin{aligned}<br>    \operatorname{Pr}\left[|X-\mathbb{E}[X]| \ge a\right] &amp;= \operatorname{Pr}\left[(X-\mathbb{E}[X])^2 \ge a^2\right] \<br>    &amp;\le \frac{\mathbb{E}\left[(X-\mathbb{E}[X])^2\right]}{a^2} \<br>    &amp;= \frac{\operatorname{Var}[X]}{a^2}<br>\end{aligned}<br>$$<br>注意到$a^2&gt;0$且$(X-\mathbb{E}[X])^2$非负，因此我们可以在第二步使用马尔科夫不等式。</p>
<p>如果我们不仅知道随机变量的期望（一阶矩），还知道其方差（二阶矩），那么切比雪夫不等式可以给出比马尔科夫不等式更为精确的上界。</p>
<h2 id="切尔诺夫上界（Chernoff-Bound）"><a href="#切尔诺夫上界（Chernoff-Bound）" class="headerlink" title="切尔诺夫上界（Chernoff Bound）"></a>切尔诺夫上界（Chernoff Bound）</h2><p>设随机变量$X=\sum_{i=1}^n X_i$，其中$X_1,\cdots,X_n$为$[0,1]$上互相独立的随机变量，则$\forall t&gt;1$：<br>$$<br>\operatorname{Pr}\left[|X - \mathbb{E}[X]| \ge t\mathbb{E}[X]\right] \le 2\exp\left(-\frac{t\mathbb{E}[X]}{3}\right)<br>$$<br>且$\forall \epsilon \in (0,1]$：<br>$$<br>\operatorname{Pr}\left[|X - \mathbb{E}[X]| \ge \epsilon\mathbb{E}[X]\right] \le 2\exp\left(-\frac{\epsilon^2\mathbb{E}[X]}{3}\right)<br>$$<br><em>加性切尔诺夫不等式（Additive Chernoff Bound）</em>：$\forall b &gt;1$：<br>$$<br>\operatorname{Pr}\left[|X - \mathbb{E}[X]| \ge b\right] \le 2\exp\left(-\frac{2b^2}{n}\right)<br>$$</p>
<h2 id="三个不等式给出上界的比较"><a href="#三个不等式给出上界的比较" class="headerlink" title="三个不等式给出上界的比较"></a>三个不等式给出上界的比较</h2><p>考虑如下问题：投$n$次均质硬币，设随机变量$X$表示头朝上的次数。估计$\operatorname{Pr}\left[X\ge \frac{3n}{4}\right]$？</p>
<p><strong>马尔科夫不等式：</strong></p>
<p>显然，$\mathbb{E}[X]=\frac{n}{2}$，且$X$非负：<br>$$<br>\operatorname{Pr}\left[X\ge \frac{3n}{4}\right] \le \frac{\frac{n}{2}}{\frac{3n}{4}} = \frac{2}{3}<br>$$<br>这个上界是很松的。</p>
<p><strong>切比雪夫不等式：</strong></p>
<p>设随机二元变量$X_i$表示第$i$次投是否头朝上，则显然$X=\sum_{i=1}^nX_i$，且易得$\operatorname{Var}[X_i]=\frac{1}{4}$，由于$X_i$两两独立，则$\operatorname{Var}[X]=\frac{n}{4}$，运用切比雪夫不等式：<br>$$<br>\begin{aligned}<br>    \operatorname{Pr}\left[X\ge \frac{3n}{4}\right] &amp;= \operatorname{Pr}\left[X - \frac{n}{2}\ge \frac{n}{4}\right] \<br>    &amp;= \frac{1}{2}\operatorname{Pr}\left[\left|X - \frac{n}{2}\right|\ge \frac{n}{4}\right] \<br>    &amp;= \frac{1}{2}\operatorname{Pr}\left[\left|X - \mathbb{E}[X]\right|\ge \frac{n}{4}\right] \<br>    &amp;\le \frac{1}{2} \frac{\frac{n}{4}}{\left(\frac{n}{4}\right)^2} \<br>    &amp;= \frac{2}{n}<br>\end{aligned}<br>$$<br><strong>切尔诺夫上界：</strong></p>
<p>显然，取$\epsilon = \frac{1}{2}$：<br>$$<br>\begin{aligned}<br>    \operatorname{Pr}\left[X\ge \frac{3n}{4}\right] &amp;= \operatorname{Pr}\left[X - \frac{n}{2}\ge \frac{n}{4}\right] \<br>    &amp;= \frac{1}{2}\operatorname{Pr}\left[\left|X - \frac{n}{2}\right|\ge \frac{n}{4}\right] \<br>    &amp;= \frac{1}{2}\operatorname{Pr}\left[\left|X - \mathbb{E}[X]\right|\ge \frac{1}{2}\mathbb{E}[X]\right] \<br>    &amp;\le \exp\left(-\frac{1}{12}\cdot \frac{n}{2}\right)\<br>    &amp;= \exp\left(-\frac{n}{24}\right)<br>\end{aligned}<br>$$<br>各上界的效果：</p>
<p><img src="/Bounds.png"></p>
<p>看来这个例子里面还是切比雪夫不等式给出的上界最好——是不是切尔诺夫上界我学到的形式本身太loose了？</p>
<h1 id="近似算法初步"><a href="#近似算法初步" class="headerlink" title="近似算法初步"></a>近似算法初步</h1><h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>若算法$A$满足以下条件，则称算法$A$是某个问题（不妨假设是最小化问题）的$\alpha$近似比的近似算法：</p>
<ol>
<li>$A$是多项式时间的。</li>
<li>对于所有输入，$A$的输出$\operatorname{soln}(A) \le \alpha \cdot\mathrm{OPT}$，其中$\mathrm{OPT}$是该输入的最优解。</li>
</ol>
<p>*对于最大化问题，第二个条件为$\operatorname{soln}(A) \ge \frac{1}{\alpha} \cdot\mathrm{OPT}$*。</p>
<p>（继续假设是最小化问题）</p>
<p>显然，为了精确计算$\alpha$我们必须知道$\mathrm{OPT}$，而这显然是不现实的（如果可以我还要近似算法干嘛？），因此我们退而求其次寻找$\mathrm{OPT}$的一个比较紧的<strong>下界</strong>，我们的解与该下界之比自然就是$\alpha$的上界了。</p>
<h2 id="例：最小顶点覆盖问题"><a href="#例：最小顶点覆盖问题" class="headerlink" title="例：最小顶点覆盖问题"></a>例：最小顶点覆盖问题</h2><p><strong>输入：</strong>$G=(V,E)$</p>
<p><strong>目标：</strong>最小化点集$S\subseteq V$，同时满足$\forall (u,v) \in E$，$u\in S$或$v \in S$。</p>
<p>这是一个知名的NP Complete问题。在这里我们设计一个简单的$2$近似算法。然而令人吃惊地是，$2$的近似比已经是我们目前能够做到的最好结果！</p>
<p><strong>思路：</strong>考虑$G$的一个<strong>极大匹配</strong>，显然极大匹配是可以在多项式时间内求出的。</p>
<p>同时注意到，任意无向图极大匹配的大小必定是其点覆盖集大小的下界，因为点覆盖必须取极大匹配当中每一条边的至少一个端点才能完成覆盖！</p>
<p><strong>算法：</strong></p>
<ol>
<li>计算$G$的一个极大匹配$M$。</li>
<li>取极大匹配所有边的所有端点为$S$。</li>
</ol>
<p><strong>为什么正确？</strong>考虑反证：若$\exists (u,v) \in E$，使$u\not\in S$且$v \not \in S$，那显然边$(u, v)$还可以加入$M$，这和$M$的极大性是矛盾的。</p>
<p>近似比证明：<br>$$<br>\begin{aligned}<br>    |S| = 2|M| \le 2\cdot \mathrm{OPT}<br>\end{aligned}<br>$$<br>得证。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2020/06/21/%E7%BB%84%E5%90%88%E6%B1%82%E5%92%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/06/21/%E7%BB%84%E5%90%88%E6%B1%82%E5%92%8C/" class="post-title-link" itemprop="url">论省选中有意思的一道组合题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-21 14:45:33" itemprop="dateCreated datePublished" datetime="2020-06-21T14:45:33+08:00">2020-06-21</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-06-27 20:01:10" itemprop="dateModified" datetime="2020-06-27T20:01:10+08:00">2020-06-27</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>省选结束了，本人作为划水3年的OIer宣告原地退役，唯一写出正解的是D1T2。我其实觉得这道题挺有意思的（虽然大佬们都说只是推式子而已……嘛，毕竟本来没期待自己能做出来），就写篇文章记一下自己的想法吧。</p>
<h1 id="题意"><a href="#题意" class="headerlink" title="题意"></a>题意</h1><p>给定整数$n, x, P\le 10^9$，以及一个$m \le 1000$次整系数多项式$f$，求<br>$$<br>\left[\sum_{k=0}^nf(k)x^k\binom{n}{k}\right]\bmod P<br>$$</p>
<h1 id="心路历程"><a href="#心路历程" class="headerlink" title="心路历程"></a>心路历程</h1><h2 id="先乱搞一波"><a href="#先乱搞一波" class="headerlink" title="先乱搞一波"></a>先乱搞一波</h2><p>看到这个题目的第一眼我觉得颇为眼熟。虽然没学过奥数，印象当中《具体数学》里面花了很大笔墨讲由这种指数，多项式以及二项式系数组合而成的和式的处理方法，似乎最后也讲到了机械求和法，然并卵，印象止步于印象，机械求合法太复杂了自己并没有记下来。</p>
<p>但是自己的残存记忆告诉我机械求和法的第一步是把求和式化成超几何函数，虽然后者我更没办法但是本着有逼就要装的思想……为什么不试一试呢？</p>
<p>什么样的级数是超几何的？《具体数学》里面给出的方法是求相邻项之比<del>幸好这个我还没有忘记</del>，而显而易见地是多项式求比是求不出具有良好形式的结果的，因此<strong>多项式必须转化为性质更优良的下降阶乘幂处理</strong>（关于下降阶乘幂我记得两年之前就写过一篇成套方法和有限微积分的博文，现在想来下降阶乘幂在离散求和问题当中真的有非常良好的性质，我在这里就沿用《具体数学》里的记号了：$k^{\underline m} = \prod_{i=0}^m (k-i)$）：<br>$$<br>\begin{aligned}<br>\frac{(k+1)^{\underline{m}}x^{k+1}\binom{n}{k+1}}{k^{\underline{m}}x^k\binom{n}{k}} &amp;= \frac{(k+1)x(n-k)}{(k-m+1)(k+1)} \<br>&amp;= \frac{(n-k)x}{k-m+1}<br>\end{aligned}<br>$$<br>不出所料，结果是一个有理函数，也就是说可以化成高斯超几何函数呢！</p>
<p>不出所料，半瓶水的某人也就知道这些了（悲）。</p>
<p>但是<strong>下降阶乘幂的思想是可以有的嘛</strong>！</p>
<h2 id="部分分摸鱼"><a href="#部分分摸鱼" class="headerlink" title="部分分摸鱼"></a>部分分摸鱼</h2><p>在乱搞如预想的那般失败之后我就开始看部分分。</p>
<p>部分分里面有一个$f$是常数的，愣了一会发现能用二项式定理，答案是$(1+x)^n$。</p>
<p>然后还有一个$x=1$的。这个要怎么解决？</p>
<p>从最简单的一次多项式开始：<br>$$<br>\sum_{k=0}^nk\binom{n}{k}=?<br>$$<br>推式子本人是不会的，结论也忘了，但是从组合意义上还是好想的：**$k\binom{n}{k}$就是从$n$个人里面选$k$个人，然后钦定一个做队长的方案数，把它求和，就是从$n$个人里面选若干人，然后从当中钦定一个队长的方案数。**这是先选人再定队长的顺序，我们可以先选队长再选人嘛！从$n$个人里面选一个队长有$n$种方法，剩下的$(n-1)$个人要不要都行，所以是$2^{n-1}$种，二者相乘：<br>$$<br>\sum_{k=0}^nk\binom{n}{k}=n2^{n-1}<br>$$<br>就把一次的式子推出来了。</p>
<p>那二次的式子呢？<br>$$<br>\sum_{k=0}^nk^2\binom{n}{k}=?<br>$$<br>如果沿用之前运用组合意义化简的思路，那$k^2$就有“可以重复选”的含义在，是不好处理的。但是之前的乱搞告诉我们，是不是化成下降阶乘幂会好处理一点呢？<br>$$<br>\sum_{k=0}^nk(k-1)\binom{n}{k}=?<br>$$<br>答案是肯定的，思路和一次的完全一样，只是从“选队长”变成了“选队长和副队长“，因此很快就可以得出：<br>$$<br>\sum_{k=0}^nk(k-1)\binom{n}{k}=n(n-1)2^{n-2}<br>$$<br>然后就可以很快地推广出去了：<br>$$<br>\sum_{k=0}^nk^{\underline{m}}\binom{n}{k}=n^{\underline{m}}2^{n-m}<br>$$<br>这样几个部分分就基本拿到了。</p>
<h2 id="把两者组合起来"><a href="#把两者组合起来" class="headerlink" title="把两者组合起来"></a>把两者组合起来</h2><p>那如果$x\neq 1$且$f$非常数要怎么做呢？我们不妨还是把$f$想成下降阶乘幂（怎么拆另说）：<br>$$<br>\sum_{k=0}^nk^{\underline{m}}x^k\binom{n}{k}=?<br>$$<br>然后思考其组合意义，稍开脑洞即可得到：</p>
<p><strong>$k^{\underline{m}}x^k\binom{n}{k}$是从$n$个人里面挑选$k$个人，再给让当中$m$人担任$m$个不同职位，最后再让每个人从$x$种颜色的帽子当中选一个戴上的方案数</strong>（不要问我怎么想到戴帽子的）。</p>
<p>因此，由加法原理，对其求和之后就是从$n$个人里面挑选<em>若干</em>个人，再给让当中$m$人担任$m$个不同职位，最后再让每个人从$x$种颜色的帽子当中选一个戴上的方案数。</p>
<p>那我们故技重施，调换顺序，不妨先从$n$个人当中调出担任$m$个职位的那$m$个人（$n^{\underline{m}}$种取法），再先让他们先选帽子（$x^m$种选法），然后让剩下的$(n-m)$个人要不挑一个颜色的帽子进队要么滚蛋（$(1+x)^{n-m}$种取法）。于是就有了：<br>$$<br>\sum_{k=0}^nk^{\underline{m}}x^k\binom{n}{k}=n^{\underline{m}}x^m(1+x)^{n-m}<br>$$<br>哇，式子就推出来了！</p>
<h2 id="多项式拆分"><a href="#多项式拆分" class="headerlink" title="多项式拆分"></a>多项式拆分</h2><p>现在基于下降阶乘幂的式子已经推出来了，唯一剩下的就是把给定的$f$拆成若干个下降阶乘幂的线性组合。<br>$$<br>\sum_{i=0}^ma_ik^i = \sum_{j=0}^m b_jk^{\underline{j}}<br>$$<br>即求$b_j$的过程。</p>
<p>显而易见地，我们需要从高次到低次拆，这样后拆出来的幂才不会对之前的结果造成影响。</p>
<p>同时显然的是，我们需要知道下降阶乘幂展开后对应多项式的系数。</p>
<p>现在回过来看，朴素的多项式乘法是完全可以胜任的。但是写多项式乘法毕竟比较繁琐，不如观察多项式系数的规律。</p>
<p>令$c[m, n]$表示下降阶乘幂$x^{\underline m}$的展开式当中$x^n$的系数。则由下降阶乘幂的定义：<br>$$<br>x^{\underline m} = x^{\underline{m-1}}[x-(m-1)],\quad (m\ge 1)<br>$$<br>可以得出递推式：<br>$$<br>c[m,n]=c[m-1,n-1]-(m-1)c[m-1,n]<br>$$<br>边界条件是$c[0,0] = 1$以及$c[m,0]=0\quad \forall m&gt;0$。这是一个类似杨辉三角的递推式，自然可以在$\mathcal{O}\left(m^2\right)$的时间内算出来，代码也好写。</p>
<p>至此，这道题目就完全解决了。</p>
<p>其实不止如此，这个三角在考场上让我感到非常眼熟，回去查证了一下，果然$c[m,n]$就是所谓的<strong>带符号的第一类斯特林数</strong>，“下降阶乘幂的展开系数”正是其重要的性质之一。</p>
<h2 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h2><p>这道题对我的感触是比较深刻的，尤其是做出来之后，颇有一种成就感。</p>
<p>细想来，我组合数学的公式其实几乎都没有背过，故而几乎所有的式子都是现场推出来的。而且推理的方式也不纯代数的暴算，而是通过combinatorial proof的方式。自从PACT学来这招之后我觉得这种方法实在是精妙。在最后自己还稀里糊涂地推演出了斯特林数的递推公式，或许这种高大上的组合数本身离我们就不遥远吧。</p>
<p>而话又说回来，大佬们看我写的这篇文章，只怕有些不耐烦与乏味吧。那些认真学习过组合数学的选手，大概看到这道题只剩下满满的套路，毕竟斯特林数名声在外，falling factorial这个套路熟悉了也不难想到，而类似的组合式子大概课后的习题会有很多吧。看到诸多大佬将D1T2云淡风轻地说成“裸的推式子”，他们做这道题时的从容大概可见一斑。只有像自己这样偶尔翻翻《组合数学》和《具体数学》，半瓶水晃荡的，才会在考场上各种心情复杂，一惊一乍了。</p>
<p>然而换一个角度，我觉得这道题对我来说真的不错，自己之前偶尔翻翻书也是。作为一道数学题，这道题并没有远远超出我的见识让我一筹莫展，也没有远远低于我的见识让我秒杀，恰是我稍微努力一下就能解决的。而这次考试正是给了日渐颓废，游手好闲的我一个“努力一下”的契机。就结果来看，解决这道题不仅给了我市选的信心，也给了我组合数学的信心，还让我在结题过程中观赏到了极佳的风景，似乎确实不赖。尤其是后者，若放在平时做题，随时可以查找资料，正确答案触手可及，那结论得出时大概也不会有考场上那么惊喜，那么愉悦了。</p>
<h2 id="逆-转"><a href="#逆-转" class="headerlink" title="逆 转"></a>逆 转</h2><p>啊？出分了？！</p>
<p>我考个250都能压线进队？！</p>
<p>我可是根本就没认真复习啊，半年没碰OI了……</p>
<p>唉，看来这次强行退役失败了，心情复杂……</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2020/04/17/PanDownload/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/17/PanDownload/" class="post-title-link" itemprop="url">自己对于PanDownload的一些想法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-04-17 16:19:14 / 修改时间：19:45:59" itemprop="dateCreated datePublished" datetime="2020-04-17T16:19:14+08:00">2020-04-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>PanDownload前几天被封了。</p>
<p>网络上那个群情激奋啊，看B站连“百度的七宗罪”都出来了。还有人把GFW做的DNS污染，域名置换等和PanDownload做的“多线程下载百度云盘”相并列，不乏讥讽地质问为何遭到制裁的是看起来程度最轻的PanDownload。</p>
<p>我不是PanDownload的使用者，自己也很少用百度云盘，或许称不上是特别利益相关者吧。</p>
<p>但看到这个新闻的时候我是很矛盾的。</p>
<p>我讨厌百度吗？</p>
<p>肯定的，我从八年前开始用百度云盘，从不限速的年代一路用到限速的坑爹时代，不恨是不可能的。</p>
<p>我喜欢PanDownload吗？</p>
<p>喜欢的，我自己两三年以前还在用很多油猴的提取直连的脚本，这种绕开限速薅羊毛的软件我不要太喜闻乐见。</p>
<p>那在这次事件中我支持PanDownload吗？</p>
<p>我其实想保持中立。</p>
<p>我们对于PanDownload等一众软件的推崇源于对于百度免费用户限速的痛恶。由俭入奢易由奢入俭难，对于限速的痛恶则源于几年前限速不存在的事实。</p>
<p>但是仔细想想，免费的大云盘这件天上掉馅饼的事情合理吗？</p>
<p>参照如今硬盘的价格以及带宽的价格，我觉得百度留着云盘业务肯定不是做慈善的。在线存储是一种服务，是企业生产的一种产品，收费这件事情本身是无可厚非的。放眼国外市场，Dropbox，Google Drive等也没有做慈善的。不是空间小就是下载慢。</p>
<p>要说百度可恶，也就可恶给用户提供了“一开始的美好”，用2TB的存储空间诱惑用户，等用户粘性培养上来之后，在几年前再限速到一个坑爹的地步，这个时候你左右为难。付钱吧，跟几年前比感觉亏了，不付钱吧，自己很多数据还存着呢。反正百度这几年的潜台词是越来越明显了：不付钱别玩，让你免费用已经是施舍你了，还BB那么多干嘛。</p>
<p>这句话很让人恼火，非常让人恼火，但是仔细思考一下，似乎是对的。云盘是一个市场，在市场里哪有永远白嫖的份。这个时候最好的结局是期待着市场竞争逼着百度降价。但是我国云盘市场的竞争着实不够激烈，百度隐隐形成垄断之势，降价看来是遥遥无期了（话又说回来，一个月25块钱的价格换算成美元大概与Google Drive差不多，其实真没那么多好抱怨的）。</p>
<p>这个时候PanDownload以及一众多线程下载软件出现了。几十个线程一起下，让免费用户看到了曙光。</p>
<p>我们不妨把PanDownload看做是网盘市场的一个有力的竞争者（虽然竞争并非其初衷），把它的下载服务看做是一个全新的网盘产品，它提供的“网盘产品”的竞争性优势在于</p>
<ol>
<li>和已有百度网盘资料的完全兼容</li>
<li>免费用户的高速下载</li>
</ol>
<p>如果PanDownload的网盘产品真的是独立而全新的，那百度该死，谁也不能阻止PanDownload一统江湖。</p>
<p>但是事实不是这个样子的，PanDownload提供的这个如此有竞争性的“产品”，是基于百度网盘的生产资料与资本建立起来的。PanDownload运用的多线程下载，亦或是其他软件的直链提取，这些都不是百度网盘官方提供的API，也不是百度网盘官方认可的。</p>
<p>因此，全民的喜闻乐见与对于百度的痛恨，也改变不了PanDownload不正当竞争（视作竞争者）或者说侵犯百度权益（是做第三方软件）的事实。</p>
<p>单纯地因为PanDownload是在造福人类，是在薅垃圾公司的羊毛，就对这种行为的本质视而不见，其实是违背法治社会的初衷的。</p>
<p>这就仿佛所有人都认为张三是人渣，李四替天行道把张三打死了就可以不犯法一样。事实上，哪怕张三是在逃的杀人犯过街喊打喊打，如果不处于类似正当防卫的情形，李四把张三打死也是不对的。故意杀人就是故意杀人。何况百度作为一家公司目前来看还没有在云盘的运营中触犯法律（或许有垄断？不清楚）。前几天在B站上看罗翔老师说“法律要考虑民众的诉求，但是要超越民众的偏见”。</p>
<p>百度这叫体量大，如果是一家新创业的公司，被这么一集体白嫖，搞得破产了怎么办？这种事情不是没有发生过。难道法律里面还要加入一条“如果体量够大而且民众不爽，某某法规就失效”？</p>
<p>如果对百度不爽，就尽量避免去用它。现在搭建一个自己的网盘已经是很简单的一件事情了。</p>
<p>何况部分用户离不开百度网盘的原因大概是因为下”资源“，所谓”资源“，又大致可以分为免费（说的不好一点就是盗版）的电影与一些淫秽资源。后者我不想多说啥（其实吧，我觉得一些黄站之于内容提供者也是PanDownload之于百度网盘的存在），但是免费下盗版竟然还有理了？</p>
<p>没错，一直白嫖一直爽是中文互联网的常态，我自己也爱装破解版软件，看视频听音乐能不付钱就不付钱，但是理直气壮地说出来又是另一回事情了。百度给你下就不错了，PanDownload让你下爽了就下爽了，但是这种处于灰色地带的软件，要较真起来，我们真的不占理。</p>
<p>或许吧，网民一直隐隐有一种心态，在网络上白嫖是对的，反正就是一堆数据拷来拷去，百度云盘也就是一个网站而已，付费下载闻所未闻。这种心态在我看来是有问题的。垄断着实可恶，但是支付给服务提供者报酬的道理还是不错的。</p>
<p>因此，我觉得PanDownload虽然对于我们是一款好软件，但是最近取缔PanDownload这一事，我觉得还是无可厚非的。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2020/04/17/IceBoat/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/17/IceBoat/" class="post-title-link" itemprop="url">从技术角度看Minecraft的高级冰船技术</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-04-17 09:09:53 / 修改时间：22:43:43" itemprop="dateCreated datePublished" datetime="2020-04-17T09:09:53+08:00">2020-04-17</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>最近比较无聊，偶尔会和同学们一起在Minecraft的私服上玩一会，现在地狱交通已经初见雏形了，nether hub已经搭好了，然而地狱交通网络应该基于哪一种运输方式还没有确定。常见的快速运输方式有两种：piston bolt和冰船。</p>
<p>很显然按照每天半个小时的游戏时间是不可能有精力做双向的piston bolt的，况且论最高速度冰船比piston bolt还是快上许多的，因此几乎毫无疑议地大家都选择了冰船。</p>
<p>这篇文章是在代码角度对于高级冰船技术的分析。</p>
<p>全文的代码均为使用官方mapping以及CFR编译器进行反编译所得（但愿这并不违反EULA）。</p>
<h1 id="带方向校准的高端冰船"><a href="#带方向校准的高端冰船" class="headerlink" title="带方向校准的高端冰船"></a>带方向校准的高端冰船</h1><p>冰船系统一直为人所诟病，也是其不如piston bolt的一点是：它在运动中是需要玩家控制的。不仅要一直按着W，还要使用AD确保船头一直向前。这在直道冰船上还好，但在斜线冰船道上就非常非常麻烦。</p>
<p>幸好，Rays Works在几个月前分享了<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=hiQTnwqrfEU">解决方案</a>。其方案的思想是：</p>
<p>如果一开始船就放正，那么就只需要W而不需要左右调整了！</p>
<p>那怎么把船放正呢？</p>
<p>观察一下代码（<code>net/minecraft/world/item/BoatItem</code>）：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">InteractionResultHolder</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ItemStack</span><span class="token punctuation">></span></span><span class="token function">use</span><span class="token punctuation">(</span><span class="token class-name">Level</span> level<span class="token punctuation">,</span> <span class="token class-name">Player</span> player<span class="token punctuation">,</span> <span class="token class-name">InteractionHand</span> interactionHand<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Object</span> object<span class="token punctuation">;</span>
    <span class="token class-name">ItemStack</span> itemStack <span class="token operator">=</span> player<span class="token punctuation">.</span><span class="token function">getItemInHand</span><span class="token punctuation">(</span>interactionHand<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">HitResult</span> hitResult <span class="token operator">=</span> <span class="token class-name">BoatItem</span><span class="token punctuation">.</span><span class="token function">getPlayerPOVHitResult</span><span class="token punctuation">(</span>level<span class="token punctuation">,</span> player<span class="token punctuation">,</span> <span class="token class-name">ClipContext<span class="token punctuation">.</span>Fluid</span><span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hitResult<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">HitResult<span class="token punctuation">.</span>Type</span><span class="token punctuation">.</span>BLOCK<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        object <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Boat</span><span class="token punctuation">(</span>level<span class="token punctuation">,</span> hitResult<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> hitResult<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> hitResult<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Boat</span><span class="token punctuation">)</span> object<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Boat</span><span class="token punctuation">)</span> object<span class="token punctuation">)</span><span class="token punctuation">.</span>yRot <span class="token operator">=</span> player<span class="token punctuation">.</span>yRot<span class="token punctuation">;</span> <span class="token comment">// !</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">return</span> <span class="token class-name">InteractionResultHolder</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>itemStack<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token class-name">InteractionResultHolder</span><span class="token punctuation">.</span><span class="token function">pass</span><span class="token punctuation">(</span>itemStack<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>yRot</code>自然是Y-axis Rotation的意思，也就是说放下船的方向直接等于当时玩家的视角方向。</p>
<p>因此如果一开始视角方向， 那么问题就解决了！</p>
<p>如何确保每一次放船的时候视角方向都是一个固定值呢？</p>
<p>Rays Works的解决方案是：用另外一艘船！</p>
<p>在<code>net/minecraft/client/player/LocalPlayer</code>当中：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">startRiding</span><span class="token punctuation">(</span><span class="token class-name">Entity</span> entity<span class="token punctuation">,</span> <span class="token keyword">boolean</span> bl<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">startRiding</span><span class="token punctuation">(</span>entity<span class="token punctuation">,</span> bl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>entity <span class="token keyword">instanceof</span> <span class="token class-name">Boat</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// !!!</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>yRotO <span class="token operator">=</span> entity<span class="token punctuation">.</span>yRot<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>yRot <span class="token operator">=</span> entity<span class="token punctuation">.</span>yRot<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setYHeadRot</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span>yRot<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以看到，当玩家乘上船的一瞬间，玩家的视角方向会强制调整到船的方向。</p>
<p>因此我们只需要准备一艘校准船，确保这艘船的角度正确，之后要使用的时候直接先做上这艘船再立刻放船再坐上新放的船就可以了（简单来说就是三连右键）。</p>
<p>这就是Rays Works视频的主旨，我这里只是找到了对应的源代码而已。</p>
<h1 id="放置角度与Minecraft的角度系统"><a href="#放置角度与Minecraft的角度系统" class="headerlink" title="放置角度与Minecraft的角度系统"></a>放置角度与Minecraft的角度系统</h1><p>Rays Works在视频当中宣称通过它的方法可以把冰道修到任何角度与朝向。</p>
<p>似乎没有什么不对？只要把校准船放到任意角度就行了。</p>
<p>然而在Ray的视频当中可以看到，有的时候明明船放下去是45°，不一会就转到了46.4°，Ray坦言这是这套冰船系统唯一比较麻烦的地方。Ray提出的解决方案是：</p>
<blockquote>
<p>If that happens, just remove this boat and place in a new one. ……and do it a couple times it actually fixes itself.</p>
</blockquote>
<p>并认为这是一个随机行为，具有一定意义上的周期性，等一会就好了。</p>
<p>事实并非如此。有一些角度是无论如何都放不到的，刚放下去一会就会微微一转，然后角度就变了。属实糟心，我在自己服务器里面放了20次都没有放成功。那个时候我终于意识到Ray的claim可能是在扯淡，于是去看了下代码。</p>
<p>代码里面似乎没有任何一处体现了“微微一转”这种行为。最上面<code>BoatItem</code>的代码就是直接把<code>yRot</code>设成了玩家的<code>yRot</code>。我用全文搜索对于<code>yRot</code>产生修改的片段，没有一处是这样的。<code>yRot</code>是用<code>float</code>存储的，应该不会产生舍入误差这种事情。</p>
<p>整个事情让我对于Minecraft的屎山代码不由生出一份敬畏，我开始觉得这是玄学问题，直到看见<code>net/minecraft/network/protocol/game/ClientboundAddEntityPacket</code>的构造函数……</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClientboundAddEntityPacket</span> <span class="token keyword">implements</span> <span class="token class-name">Packet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ClientGamePacketListener</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> xRot<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> yRot<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ClientboundAddEntityPacket</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token class-name">UUID</span> uUID<span class="token punctuation">,</span> <span class="token keyword">double</span> d<span class="token punctuation">,</span> <span class="token keyword">double</span> d2<span class="token punctuation">,</span> <span class="token keyword">double</span> d3<span class="token punctuation">,</span> <span class="token keyword">float</span> f<span class="token punctuation">,</span> <span class="token keyword">float</span> f2<span class="token punctuation">,</span> <span class="token class-name">EntityType</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> entityType<span class="token punctuation">,</span> <span class="token keyword">int</span> n2<span class="token punctuation">,</span> <span class="token class-name">Vec3</span> vec3<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>xRot <span class="token operator">=</span> <span class="token class-name">Mth</span><span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>f <span class="token operator">*</span> <span class="token number">256.0f</span> <span class="token operator">/</span> <span class="token number">360.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>yRot <span class="token operator">=</span> <span class="token class-name">Mth</span><span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>f2 <span class="token operator">*</span> <span class="token number">256.0f</span> <span class="token operator">/</span> <span class="token number">360.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>以及<code>net/minecraft/client/multiplayer/PacketListener</code>如何处理这个packet的:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleAddEntity</span><span class="token punctuation">(</span><span class="token class-name">ClientboundAddEntityPacket</span> clientboundAddEntityPacket<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Entity</span> entity<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>entity <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        entity<span class="token punctuation">.</span>xRot <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">(</span>clientboundAddEntityPacket<span class="token punctuation">.</span><span class="token function">getxRot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">360</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">256.0</span> f<span class="token punctuation">;</span>
        entity<span class="token punctuation">.</span>yRot <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span><span class="token punctuation">(</span>clientboundAddEntityPacket<span class="token punctuation">.</span><span class="token function">getyRot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">360</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">256.0</span> f<span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>哦……原来还真有舍入误差这回事……Mojang大概想省空间，虽然rotation在客户端和服务端内部都是<code>float</code>存储的，但是在网络传输的时候硬是塞到了<code>byte</code>里面。于是在这一层转换的帮助下，Minecraft理论上就只有256种可能的角度了。</p>
<p>我猜测的整个放船的流程大致如下：</p>
<ol>
<li>客户端玩家手持船右键</li>
<li>客户端发出一个<code>ServerboundUseItemPacket</code></li>
<li>服务端接收到<code>ServerboundUseItemPacket</code>，然后执行<code>BoatItem</code>有关的代码</li>
<li>服务端新增船的实体，想客户端发送<code>ClientboundAddEntityPacket</code>，这个时候角度被舍入了</li>
<li>客户端收到<code>ClientboundAddEntityPacket</code>，将本地的船同步为舍入的角度，在10gt的插值作用下体现为“微微一转”</li>
<li>玩家坐上去，这个时候一系列网络同步把服务端的船的角度也舍入了</li>
</ol>
<pre class="line-numbers language-mermaid" data-language="mermaid"><code class="language-mermaid">sequenceDiagram
    participant Client
    participant Server
    Note left of Client: Player right clicks
    Client-&gt;&gt;Server: ServerboundUseItemPacket
    Note right of Server: Execute code in &lt;br&#x2F;&gt; BoatItem.use
    Server-&gt;&gt;Client: ClientboundAddEntityPacket<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>因此，微微一转的问题其实根本就不是Ray说的随机事件，而是在网络传输当中舍入误差加上客户端线性插值带来的现象。看似的随机只是因为F3的精度不够，44.99和45.01都显示为45.0，虽然从代码当中我们可以清晰地看到两个数的舍入结果是不一样的。</p>
<p>这么做的好处是对于90°，45°等特殊角这一层舍入可以保证绝对的精确，避免了放成45.01°然后在船上开1000格偏离航道的惨剧。缺点是很多角度就不能精确达到了。两个相邻的可达角度差1.40625°，大概勉强可以接受。</p>
<p>话又说回来了，<code>ServerboundMovePlayerPacket</code>这种同步玩家信息倒是还是用<code>float</code>作为载体的。所以玩家的角度还是很精确的？难道是因为玩家相对于实体少很多所以有更多流量可以挥霍？</p>
<p>我再次对于Minecraft的代码肃然起敬。</p>
<h1 id="辅助高级冰船的Scarpet脚本"><a href="#辅助高级冰船的Scarpet脚本" class="headerlink" title="辅助高级冰船的Scarpet脚本"></a>辅助高级冰船的Scarpet脚本</h1><p>在知道这些之后我们就可以有针对性地设计冰道了，因为人比较懒所以我写了一个scarpet的脚本：</p>
<pre class="line-numbers language-none"><code class="language-none">__command() -&gt; null;

_ice_mark(x, y, z) -&gt; create_marker(&#39;ICE&#39;, l(x + 0.5, y + 0.5, z + 0.5));

_mark_x(y, x1, z1, x2, z2, w) -&gt; (
	if(x1 &gt; x2, l(x1, x2, z1, z2) &#x3D; l(x2, x1, z2, z1));
	k &#x3D; (z2 - z1) &#x2F; (x2 - x1);
	for(range(x1, x2 + 1),
		x &#x3D; _; z &#x3D; round((x - x1) * k + z1);
		for(range(-w + 1, w), _ice_mark(x, y, z + _))
	)
);

_mark_z(y, x1, z1, x2, z2, w) -&gt; (
	if(z1 &gt; z2, l(x1, x2, z1, z2) &#x3D; l(x2, x1, z2, z1));
	k &#x3D; (x2 - x1) &#x2F; (z2 - z1);
	for(range(z1, z2 + 1),
		z &#x3D; _; x &#x3D; round((z - z1) * k + x1);
		for(range(-w + 1, w), _ice_mark(x + _, y, z))
	)
);

mark(y, x1, z1, x2, z2, w) -&gt; (
	dx &#x3D; abs(x1 - x2); dz &#x3D; abs(z1 - z2);
	if(dx &#x3D;&#x3D; 0 || dx &lt; dz, _mark_z(y, x1, z1, x2, z2, w),
		_mark_x(y, x1, z1, x2, z2, w))
);

clear() -&gt; remove_all_markers();

_wrap_deg(x) -&gt; (
	tmp &#x3D; x % 360.0;
	if(tmp &lt; -180, tmp + 360, tmp &gt; 180, tmp - 360, tmp)
);

_wrap_internal(x) -&gt; (
	tmp &#x3D; x % 360.0;
	if (tmp &lt; 0, tmp + 360, tmp)
);

_angle(x1, z1, x2, z2) -&gt; -atan2(x2 - x1, z2 - z1);

_floor_angle(x) -&gt; _wrap_deg(floor(x * 256 &#x2F; 360.0) * 360 &#x2F; 256);

angle(x1, z1, x2, z2) -&gt; (
	theta &#x3D; _angle(x1, z1, x2, z2);
	print(str(&#39;exact yaw: %f&#39;, theta));
	lb &#x3D; floor_angle(_wrap_internal(theta));
	ub &#x3D; floor_angle(_wrap_internal(theta + 360.0 &#x2F; 256));
	print(str(&#39;floored yaw (lb): %f&#39;, lb));
	print(str(&#39;floored yaw (ub): %f&#39;, ub));
	ret &#x3D; if(abs(lb - theta) &lt; abs(ub - theta), lb, ub);
	print(str(&#39;suggested yaw: %f&#39;, ret));
);

_best_angle(x1, z1, x2, z2) -&gt; (
	theta &#x3D; _angle(x1, z1, x2, z2);
	lb &#x3D; floor_angle(_wrap_internal(theta));
	ub &#x3D; floor_angle(_wrap_internal(theta + 360.0 &#x2F; 256));
	if(abs(lb - theta) &lt; abs(ub - theta), lb, ub)
);

adjust(x1, z1, x2, z2, dir) -&gt; (
	x &#x3D; _best_angle(x1, z1, x2, z2);
	ov &#x3D; 360; opt &#x3D; 0;
	print(str(&#39;yaw: %f&#39;, x));
	if(
		dir &#x3D;&#x3D; &#39;x&#39;,
		for(range(x2 - 1000, x2 + 1000), 
			tmp &#x3D; abs(_angle(x1, z1, _, z2) - x);
			if (tmp &lt; ov, ov &#x3D; tmp; opt &#x3D; _)
		);
		print(str(&#39;%f %f %f %f&#39;, x1, z1, opt, z2)),
		dir &#x3D;&#x3D; &#39;z&#39;,
		for(range(z2 - 1000, z2 + 1000), 
			tmp &#x3D; abs(_angle(x1, z1, x2, _) - x);
			if (tmp &lt; ov, ov &#x3D; tmp; opt &#x3D; _)
		);
		print(str(&#39;%f %f %f %f&#39;, x1, z1, x2, opt)),
		print(&#39;direction must either be x or z&#39;)
	)
)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>用法如下：</p>
<ol>
<li><p><code>/iceboat y x1 z1 x2 z2 w</code>标记一条从$(x_1,y,z_1)$到$(x_2,y,z_2)$的，宽度为$2w-1$的冰道。</p>
</li>
<li><p><code>/iceboat clear</code>清除标记。</p>
</li>
<li><p><code>/iceboat angle x1 z1 x2 z2</code>计算站在$(x_1,z_1)$望向$(x_2,z_2)$的视角方向，最近的两个可达角度，以及推荐的可达角度。</p>
</li>
<li><p><code>/iceboat adjust x1 z1 x2 z2 x/z</code>固定$(x_1,z_1)$，沿$x/z$轴在$(x_2,z_2)$附近寻找最贴近可达角度的方块坐标。考虑到在几千格之后哪怕0.7°的角度差都会有导致最终百格的偏差，这个命令非常重要。在算法实现角度，用三分写是最快的，但是考虑到从-180°到180°有一个不连续间断点，导致写三分会涉及到一些繁琐的细节。我比较懒，所以就用了比较慢的写法（这个写法其实也有明显bug，但是我不准备修）。</p>
</li>
</ol>
<p>常见的使用流程：</p>
<ol>
<li>确定冰道的两点。</li>
<li>固定一点（通常是nether hub或者已经固定留好空间的端点），使用<code>/iceboat adjust</code>微调另一端点的位置。同时计算得出角度。</li>
<li>使用<code>/iceboat mark</code>标记放冰的位置。</li>
<li>放冰。</li>
<li>使用<code>/iceboat clear</code>清除标记。</li>
</ol>
<p>目前比较不人性化的一点是carpet的<code>create_marker</code>用的是隐形盔甲架实现的，hitbox的制约导致有的时候放不了方块，用area effect cloud可能可以解决这个问题。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2020/04/03/Gradle%E5%88%9D%E6%8E%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/04/03/Gradle%E5%88%9D%E6%8E%A2/" class="post-title-link" itemprop="url">Gradle初探</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2020-04-03 20:02:19 / 修改时间：22:26:34" itemprop="dateCreated datePublished" datetime="2020-04-03T20:02:19+08:00">2020-04-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>自己最近又在用JVM系的语言开新坑。这次终于说服自己从Jetbrains的温床里脱离出来改用了大家都在用的Gradle！感觉良好，在这里简单写一下大概咋用，给之后的自己留一个参考吧。</p>
<p>为什么自己要用Gradle呢？</p>
<ol>
<li>Gradle作为一个开源的构建系统不与任何IDE绑定（比如说IDEA），这相当于增加了代码的兼容性。</li>
<li>Gradle里面可以直接从Maven Central上下库下来，省了我手动下库导入的过程，库更新了也好维护。这对我来说非常地有诱惑力。实测也非常舒服。</li>
<li>Gradle从设计上来说非常灵活，Gradle默认的构建脚本是用Groovy写的（当然也可以用Kotlin但是这似乎不是主流的样子），而不是只有标记功能的XML，这使Gradle一下子非常强大。</li>
<li>大家都在用的样子。</li>
<li>IDEA对于Gradle的支持非常棒！（所以到头来自己还是没有逃脱JB的舒适圈……）</li>
</ol>
<p>虽然说Gradle的功能很强大我目前的用法还是最初级的。我目前用的Gradle代码大致如下：</p>
<pre class="line-numbers language-groovy" data-language="groovy"><code class="language-groovy">plugins <span class="token punctuation">&#123;</span>
    id <span class="token string">'java'</span>
    id <span class="token string">'org.jetbrains.kotlin.jvm'</span> version <span class="token string">'1.3.61'</span>
<span class="token punctuation">&#125;</span>

group <span class="token string">'chengyuan'</span>
version <span class="token string">'1.0-SNAPSHOT'</span>

sourceCompatibility <span class="token operator">=</span> <span class="token number">1.8</span>
project<span class="token punctuation">.</span>ext<span class="token punctuation">.</span>lwjglVersion <span class="token operator">=</span> <span class="token string gstring">"3.2.3"</span>
project<span class="token punctuation">.</span>ext<span class="token punctuation">.</span>lwjglNatives <span class="token operator">=</span> <span class="token string gstring">"natives-windows"</span>

repositories <span class="token punctuation">&#123;</span>
    maven <span class="token punctuation">&#123;</span> url <span class="token string">'http://maven.aliyun.com/nexus/content/groups/public/'</span> <span class="token punctuation">&#125;</span>
    maven <span class="token punctuation">&#123;</span> url <span class="token string gstring">"https://oss.sonatype.org/content/repositories/snapshots/"</span> <span class="token punctuation">&#125;</span>
    <span class="token function">mavenCentral</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

dependencies <span class="token punctuation">&#123;</span>
    implementation <span class="token function">platform</span><span class="token punctuation">(</span><span class="token string gstring">"org.lwjgl:lwjgl-bom:<span class="token expression"><span class="token punctuation">$</span>lwjglVersion</span>"</span><span class="token punctuation">)</span>
    
    implementation <span class="token string gstring">"org.lwjgl:lwjgl"</span>
    implementation <span class="token string gstring">"org.lwjgl:lwjgl-assimp"</span>
    implementation <span class="token string gstring">"org.lwjgl:lwjgl-bgfx"</span>
    implementation <span class="token string gstring">"org.lwjgl:lwjgl-glfw"</span>
    implementation <span class="token string gstring">"org.lwjgl:lwjgl-nanovg"</span>
    implementation <span class="token string gstring">"org.lwjgl:lwjgl-nuklear"</span>
    implementation <span class="token string gstring">"org.lwjgl:lwjgl-openal"</span>
    implementation <span class="token string gstring">"org.lwjgl:lwjgl-opengl"</span>
    implementation <span class="token string gstring">"org.lwjgl:lwjgl-par"</span>
    implementation <span class="token string gstring">"org.lwjgl:lwjgl-stb"</span>
    implementation <span class="token string gstring">"org.lwjgl:lwjgl-vulkan"</span>
    runtimeOnly <span class="token string gstring">"org.lwjgl:lwjgl::<span class="token expression"><span class="token punctuation">$</span>lwjglNatives</span>"</span>
    runtimeOnly <span class="token string gstring">"org.lwjgl:lwjgl-assimp::<span class="token expression"><span class="token punctuation">$</span>lwjglNatives</span>"</span>
    runtimeOnly <span class="token string gstring">"org.lwjgl:lwjgl-bgfx::<span class="token expression"><span class="token punctuation">$</span>lwjglNatives</span>"</span>
    runtimeOnly <span class="token string gstring">"org.lwjgl:lwjgl-glfw::<span class="token expression"><span class="token punctuation">$</span>lwjglNatives</span>"</span>
    runtimeOnly <span class="token string gstring">"org.lwjgl:lwjgl-nanovg::<span class="token expression"><span class="token punctuation">$</span>lwjglNatives</span>"</span>
    runtimeOnly <span class="token string gstring">"org.lwjgl:lwjgl-nuklear::<span class="token expression"><span class="token punctuation">$</span>lwjglNatives</span>"</span>
    runtimeOnly <span class="token string gstring">"org.lwjgl:lwjgl-openal::<span class="token expression"><span class="token punctuation">$</span>lwjglNatives</span>"</span>
    runtimeOnly <span class="token string gstring">"org.lwjgl:lwjgl-opengl::<span class="token expression"><span class="token punctuation">$</span>lwjglNatives</span>"</span>
    runtimeOnly <span class="token string gstring">"org.lwjgl:lwjgl-par::<span class="token expression"><span class="token punctuation">$</span>lwjglNatives</span>"</span>
    runtimeOnly <span class="token string gstring">"org.lwjgl:lwjgl-stb::<span class="token expression"><span class="token punctuation">$</span>lwjglNatives</span>"</span>
    
    testCompile group<span class="token punctuation">:</span> <span class="token string gstring">"junit"</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string gstring">"junit"</span><span class="token punctuation">,</span> version<span class="token punctuation">:</span> <span class="token string gstring">"4.12"</span>
<span class="token punctuation">&#125;</span>

compileKotlin <span class="token punctuation">&#123;</span>
    kotlinOptions<span class="token punctuation">.</span>jvmTarget <span class="token operator">=</span> <span class="token string gstring">"1.8"</span>
<span class="token punctuation">&#125;</span>

compileTestKotlin <span class="token punctuation">&#123;</span>
    kotlinOptions<span class="token punctuation">.</span>jvmTarget <span class="token operator">=</span> <span class="token string gstring">"1.8"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>首先是<code>plugins</code>这段，这一段虽然重要但一般用不着特别操心，按照我的理解大概是语言支持的插件。</p>
<p>接下来是版本、JVM版本之类的，看着也很明白。</p>
<p>然后可以申明一些接下来会用到的常量。</p>
<p><code>repository</code>告诉Gradle从哪里找库。常见的源有内置的函数，例如<code>mavenCentral()</code>，<code>jcenter()</code>。如果是其他的Maven源也可以指定URL。比如说我这里用了阿里云的Maven镜像，在国内速度就会快上很多。</p>
<p>接下来是<code>dependencies</code>，这个是重头戏。</p>
<p>最常见的是<code>implementation</code>，这个后面一般跟库的Maven id。如果想直接引用本地文件可以用<code>files(...)</code>，如果是一个平台一个版本的可以用<code>platform(...)</code>。基本上这就覆盖了99%的用途。</p>
<p>此外还有<code>runtimeOnly</code>，这个和<code>implementation</code>的区别就是<code>runtimeOnly</code>的库是不参与编译的，只在运行期有效。这一般都是用JNI的一众native库和一些二级库。</p>
<p>还有<code>testCompile</code>，用这个修饰的库是只在跑单元测试的时候依赖的，因此基本上都是一些测试有关的库。我人懒，平时懒得写单元测试，因此这个我基本上不用。</p>
<p>这些就是我目前摸索出来的Gradle的基本用法，目前的感觉就是把IDEA里面的很多GUI的操作文字化，非常舒适，省了很多麻烦。更复杂的用法例如自定义build task等都可以在官网上找到（文档很丰富也是Gradle比较吸引人的点）。</p>
<p>最后有一点点想吐槽，就是Groovy似乎单引号和双引号都可以表示字符串。双引号的字符串支持插值，这似乎是唯一的予以区别。IDE默认生成的是单引号，LWJGL的打包器生成的是双引号，似乎最通用的是双引号，自己到底是用双引号还是单引号呢？这种东西真的是万恶之源。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2020/03/29/FuckZhihu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/29/FuckZhihu/" class="post-title-link" itemprop="url">退乎，与自省</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-03-29 21:08:26" itemprop="dateCreated datePublished" datetime="2020-03-29T21:08:26+08:00">2020-03-29</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-03-30 10:45:22" itemprop="dateModified" datetime="2020-03-30T10:45:22+08:00">2020-03-30</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>上一次发文章已经是三个星期以前了。</p>
<p>感到一丝焦虑，但三个星期中确实没有做成值得写一写的事情是一个令人沮丧的事实。</p>
<p>开学了人忙了是一个原因。人一忙，一个矛盾愈发凸显。</p>
<p><strong>理性上对于系统化学习的追求与感性上沉溺于碎片化知识平台的矛盾。</strong></p>
<p>自己要应付AP考试还有一整本的Gregory Mankiw的经济学要看。</p>
<p>自己现在还在看柏拉图的《理想国》，书很好看，觉得很有启发。</p>
<p>地理的等级考也是要准备起来的。</p>
<p>文书也是要做起准备的。</p>
<p>个人的项目也是要做的。</p>
<p>退一步讲，自己还有一个追番TODO List还要十几部番要追，轻小说TODO List还有几部要抽空看。</p>
<p>当时间就剩下这么一点，知乎这么一个搅屎棍的存在就显得令人恼火了。</p>
<p>自己之前一直看不起快手和抖音，觉得这种垃圾玩意纯粹就是让人上瘾的。</p>
<p>可悲的是，自己也成了知乎的奴隶。</p>
<p>确实我在鄙视链上比抖音快手高一级，但是当鄙视链的每一根链环都足够拴着你吃屎的时候，其实区别不大。</p>
<p>知乎不知不觉成为了我常逛的唯一平台。居然占据了30%的耗电，难道这不恐怖吗？</p>
<p>只是为了看时事，结果刷了一个小时，难道这不恐怖吗？</p>
<p>我觉得是时候好好反思反思了。</p>
<p>要是这一个小时有营养就算了。</p>
<p>现在的知乎，90%的回答就是在玩烂梗。时政问题下就是两个极端的口诛笔伐，喊入关的喊入关，吹国外的吹国外，骂公知的骂公知。党同伐异，贴上标签就开骂，评论区里友善度堪比电竞祖安。</p>
<p>国家自信的大旗已经举起，反公知的政治正确俨然形成。这着实是好事，但是被这股情绪裹挟着消磨时间又是另一回事了。</p>
<p>人们说政治是一个门槛看起来低实际上高得很的学科。谁都能对政治发表一番高论，但是要使理论逻辑自洽，预测准确一致就需要非常高的水平。</p>
<p>知乎上大体是前者。山高死而入关兴，大家都在喊入关，要么就国家拟人化走一波，大家还就好这一口。</p>
<p>敢情我是来看波兰球动画的呢？</p>
<p>不然要么就恶政隐或者膜蛤走一波，下面的评论狂喊冲塔冲塔枪毙枪毙药丸药丸下个账号再见，不亦乐乎，谁说天朝子民不可妄议朝政？</p>
<p>但是我现在真的觉得让我们普罗大众表达诉求可以，玩键盘政治或许不值得提倡。</p>
<p>我记得16年刚玩知乎的时候，还是有很多很有意义的回答的。比如说人民群众喜闻乐见的知乎如意勺系列，虽然问题虚构荒诞，但是科普的目的确实达到了。每一篇文章洋洋洒洒干货十足，比起现在一千万和蜗牛的虚构问题不知道高到哪里去了。</p>
<p>现在还有这么多干货文章吗？有的，引经据典的回答终究是有的，之前在知乎上看到的毕导的科普视频也是很好的。但是这些都被大大稀释了，到现在，为了这么一篇好文章刷过50篇朱一旦，营销号，观察者网或者环球时报似乎不值得。</p>
<p>我不知道是资本的入驻使知乎变了味，还是推荐算法使然。</p>
<p>我倾向于后者。</p>
<p>推荐算法实在是太恐怖了。</p>
<p>它恐怖就恐怖在它是一个正反馈系统，平衡点是不稳定的。只要思想稍有偏差，就会迅速滚到一个极端去。</p>
<p>它迎合你，让你每一时刻都享受英雄所见略同的快感。很多时候看前两句句你就知道这篇文章要讲啥，但是禁不住讲的东西你喜欢，于是又看了下去。很多时候回答就只有两句，篇幅完全不重要。我逛知乎的心态已经从以往的获取知识，到寻求附和与认同为主，能看到啥就学啥为辅的情况了，非常可悲。自己当真就没有独立思考的能力和对此的自信？</p>
<p>小群体内的自我认同除了加深偏执以外不会引入新的思想，甚至还会降低你对异见的容忍度，看到不一样的观点就烦躁，哪怕它的长篇大论是真的有论点有论据有深度可以学到东西的。知乎里现在键政领域两极分化，推荐算法功不可没。</p>
<p>当一个问答网站将迎合用户，附和用户作为首要任务，而不是去挑战用户的认知，扩充用户的头脑的话，这个网站可就真的忘了初心，出了大问题了。</p>
<p>或许也没有忘初心，万一人家初心就是赚钱呢。</p>
<p>现在想想我每天干嘛？去知乎看人嘲讽美国防疫，还是看人调侃美股八熔八耻？</p>
<p>但是我又不是靠知乎获得这些信息的。我每天一大早都是自己去JHU的网站上查人数，自己查道指的。小米内置的资讯在遇到大新闻的时候也没落下。也就是我不断心理暗示知乎是一个获得时政新闻的平台，其实根本不是。那我天天去干嘛？我贱不贱啊？贱不贱啊？</p>
<p>自己完全是被动地被知乎牵着鼻子走，可太悲哀了。</p>
<p>另一方面，知乎的产品设计实在是太高明了。 </p>
<p>我觉得我还是要回归搜索引擎。</p>
<p>搜索引擎有两个好，一个是它没有针对个人的推荐算法，另一个是你永远有主动权。你搜索什么它给什么。你不搜它不给，爽到。搜出来的结果分散于网络，不容易对于一个平台形成粘性。因此，只要搜索引擎的算法不是特别差（比如说Google），用搜索引擎就不会有大问题。</p>
<p>被搜索引擎带到知乎和直接在知乎搜索栏里搜索是完全两个不一样的概念。</p>
<p>搜索引擎的覆盖面比知乎高，那我为啥不用搜索引擎呢？</p>
<p>我要学习技术，我为啥不去SO、V2EX、SF之类的呢？</p>
<p>同样是刷手机，我为啥不去B站上看看罗翔追追番呢？前者能普法，后者比看垃圾梗更娱乐一点。</p>
<p>为什么呢？</p>
<p>自己之前真的是懒。妄想着知乎一个平台就够了，结果被灌屎，被偶尔尝到的糖吊着胃口，持续地被喂屎。</p>
<p>太糟糕了，实在是太糟糕了。</p>
<p>丹麦哲学家 Søren Kierkegaard 讲过一句话，现在想起来觉得实在是太对了。</p>
<blockquote>
<p>People demand freedom of speech as a compensation for the freedom of thought which they seldom use.</p>
</blockquote>
<p>把知乎卸了。搜索引擎搜到还是会看一下，但是不会主动逛了。</p>
<p>但愿不会真香。</p>
<hr>
<p>其实吧，我觉得，自己退出知乎的这个决定在我看来也是很可悲的。</p>
<p>因为这是我对于无法解决实际问题的一个逃避。</p>
<p>控制不住逛知乎，知乎用户粘性很高是外因，自己不自制是内因。外因通过内因而起作用。</p>
<p>有的时候我觉得虽然学校的政治课大多弱智，但是一些矛盾论以及唯物辩证的思路终究还是受用的。</p>
<p>自己究竟什么时候才会认认真真审视自己自制力不够的问题呢？</p>
<p>我如何才能避免自己看知乎变成看B站呢？</p>
<p>我自以为知乎比B站容易上瘾，先这么自以为着吧。与自己的颓废欲望做出妥协。</p>
<hr>
<p>搜索引擎让我掌握了主动权，但是主动权往往是不够的。我要主动搜啥呢？</p>
<p>正如YPM里面Humphrey说的，I have to know everything so that I can decide whether I need them!</p>
<p>我也有同学说知乎平台里面有很多宝藏回答，我自己也觉得很多时候知乎的热榜里有热点新闻，这是知乎的价值。</p>
<p>可以料想到的是，我现在退出知乎以后，终究要有一个信息平台顶替它的位置，keeping myself well-informed.</p>
<p>这个平台会是什么呢？</p>
<p>我不期望是一个正反馈的系统，今日头条之类的肯定不行。</p>
<p>直接看新闻？新闻是一个无反馈的系统，但为了避免被带入一家的政治立场当中去就要各种立场的新闻都看，不知道有没有时间。</p>
<p>并没有人设计过负反馈的信息平台，估计也不会有人设计这种吃力不讨好的玩意，虽然这是最好的。</p>
<p>朋友圈或许可以，让亲戚朋友代我受这些正反馈平台的戕害自然是最好不过的了（感觉自己的思想还是有点阴暗），反正他们在朋友圈几句话也不足以左右我本身的判断，他们转发的文章我也未必要看，我要的就是这件事情本身，这样我就可以自己去搜了。</p>
<p>唉。有的时候我觉得学数理之类的不用区分立场，逻辑与实验自有定论，省了我的脑细胞，是我作为理科生的幸运，但让我缺乏批判性思考的锻炼，又是我作为理科生的不幸。以至于面对正反馈带来的立场极端化不得不采取“闭关锁国”的战略，我也不知道是不是好事。我一直认为，如果有人能够依靠自己的批判性思维带来的负反馈效用力压推荐算法的正反馈，以至于在主流平台当中依然可以保持相对地客观，那是真的厉害。</p>
<p>另一种自暴自弃的思路莫过于，创造一种统一的政治立场，有一个绝对的权威来树立绝对的政治正确，这样大家都处在同一个立场，提前到达了正反馈的极限，正反馈也就没用了。这正如西方对于我国的态度。一个小圈子里互相认同而偏执是悲哀，但是如果几十亿人不断地相互认同而产生的根深蒂固的思潮，我也不知道是好是坏。它确实湮灭了所有的异见也降低了头脑在这个问题的负担，但也导致新思维的短缺。站在民智发展的角度来看，这样很危险，但是站在统战的角度上，这样似乎又不是不行。</p>
<p>我从未学过认知论也从未学过教育学，但是我推断人类的认知过程本身不可避免地是一个先天的正反馈过程，别人的认可是激励，别人的反驳是惩罚。在基础教育的过程中，“别人”单指老师与同学，因此这个思路被不断提倡，而当到了网络的辩论场，人们自动就会把“别人”的定义延拓了。要逆转这个态势，审慎地对待别人的认可，积极地面对别人的反驳，小心翼翼地避免矫枉过正，在这个时代还要对抗推荐算法，实在是不容易。而如果只有一个人能够做到这一步，那么这个人被孤立于群体之中，也未必如之前一样快乐。</p>
<p>因此我越看《理想国》，越觉得像里面的苏格拉底一样在辩论中不恼羞成怒诉诸于人身攻击，反而通过设问，在多个立场之间来回切换，将辩论用作真正探寻真理的途径而非自我膨胀的乱骂一通，实在是一种非常高明的智慧。我觉得自己离这个境界差远了，而对于是否所有人都能拥有这个智慧，是否应该拥有这份智慧，拥有这份智慧之后是否会感到快乐，我现在很悲观。</p>
<p>唉，自己社科不行，也只能乱发牢骚一通。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2020/02/28/Manjaro-VM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/28/Manjaro-VM/" class="post-title-link" itemprop="url">用LaTeX实时记数学笔记？！</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-02-28 08:42:53" itemprop="dateCreated datePublished" datetime="2020-02-28T08:42:53+08:00">2020-02-28</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-03-02 14:50:03" itemprop="dateModified" datetime="2020-03-02T14:50:03+08:00">2020-03-02</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>我几个月前看到国外有人<a target="_blank" rel="noopener" href="https://castel.dev/post/lecture-notes-1/">分享</a>用LaTeX实时记1700页数学笔记的感受，当时就被惊艳到了，心生向往。这次因为疫情待在家里上在线课程，总算是给了我一个带电脑进课堂的机会。于是我也仿照原作者的做法尝试了用记LaTeX笔记，这篇文章就来写一写我配置环境时遇到的坑和使用感受。</p>
<h1 id="系统选择"><a href="#系统选择" class="headerlink" title="系统选择"></a>系统选择</h1><p>原文的作者采用的是Ubuntu发行版+bspwm作为桌面管理器，但是bspwm太小众，网上的资料很少。而且实测装在Ubuntu上默认的配置在视觉上不协调（还要自己去装一个像样的状态栏，总之就是太烦了）。相比之下i3作为另一个Tiling Window Manager比bspwm资料多多了，也比较适合我这种小白。权衡之下我选用Manjaro + i3。在Virtual Box下安装。</p>
<h1 id="配置镜像"><a href="#配置镜像" class="headerlink" title="配置镜像"></a>配置镜像</h1><p>这一步不是必须的，因为Manjaro的默认源在国内的速度也还可以接受（~400kBps）。但是换了交大的源之后可以到10MBps：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> pacman -Syy
<span class="token function">sudo</span> pacman-mirrors -i -c China -m rank
<span class="token function">sudo</span> pacman -Syyu<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>然后编辑<code>/etc/pacman.conf</code>加上ArchLinuxCN的交大镜像：</p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token selector">[archlinuxcn]</span>
<span class="token constant">SigLevel</span> <span class="token attr-value"><span class="token punctuation">=</span> Optional TrustedOnly</span>
<span class="token constant">Server</span> <span class="token attr-value"><span class="token punctuation">=</span> https://mirrors.sjtug.sjtu.edu.cn/archlinux-cn/$arch</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>最后导入一下密钥环，镜像就配置完了：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> pacman -Syy <span class="token operator">&amp;&amp;</span> <span class="token function">sudo</span> pacman -S archlinuxcn-keyring<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h1 id="安装Virtual-Box-GA"><a href="#安装Virtual-Box-GA" class="headerlink" title="安装Virtual Box GA"></a>安装Virtual Box GA</h1><p>Manjaro默认对于虚拟机的支持不是很好。我不选择在VMWare上装Manjaro的主要原因也是因为我没有找到VMWare下自动分辨率比较简单的解决方案。在Virtual Box下只要装Virtual Box Guest Addition就可以了，美滋滋。</p>
<p>先安装基本的编译套件：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> pacman -S gcc <span class="token function">make</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>然后查看一下Linux内核版本：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">uname</span> -r<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>是5.4，因此安装5.4的headers：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> pacman -S linux54-headers<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>之后在Virtual Box菜单下插入GA的iso文件。我最初是手动挂载的（因为找不到i3里面怎么开文件管理器），就是<code>sudo blkid</code>看一下设备然后<code>mount</code>（如果出现不支持<code>iso9660</code>直接重启）。后来意识到文件管理器的名字是<code>pcmanfm</code>，再发现默认可以直接<code>mod + F3</code>打开文件管理器，于是就可以在上面直接操作了。<code>cd</code>进去运行<code>autorun.sh</code>跑完重启。就发现可以自动适应外部分辨率以及共享剪贴板了，非常方便。</p>
<h1 id="配置键位"><a href="#配置键位" class="headerlink" title="配置键位"></a>配置键位</h1><p>默认Manjaro配置的<code>mod</code>键是<code>super</code>，也就是Win键。但是实测Win键在虚拟机环境下会有小问题（例如Win + L总是会被Windows先拦截导致锁屏）。所以我到<code>~/.i3/config</code>里面把<code>mod</code>键改成了<code>alt</code>。我还把i3默认的<code>jkl:</code>键位改成了和Vim相一致的<code>hjkl</code>键位。</p>
<h1 id="中文相关"><a href="#中文相关" class="headerlink" title="中文相关"></a>中文相关</h1><p>Manjaro默认的中文渲染很有问题（装系统的时候居然没有中文字体！）。因此需要手动配置中文的渲染。</p>
<p>我基本上是按照<a target="_blank" rel="noopener" href="https://wiki.archlinux.org/index.php/Font_Configuration/Chinese_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">Arch Wiki</a>上的Android类字体配置的。但是Arch Wiki上没有配置给终端用的等宽字体，需要个人发挥一下。我最喜欢的等宽字体是Sarasa Gothic（因为有中文）（去除中文我现在最喜欢的是Jetbrains Mono）。我发现ArchLinuxCN的源上已经有这款字体了，于是直接安装：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> pacman -S ttf-sarasa-gothic<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>然后修改<code>~/.Xresources</code></p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini">URxvt.font: xft:Sarasa Term SC:size<span class="token attr-value"><span class="token punctuation">=</span>12</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>重启一下就好了（其实不用重启，<code>xrdb ~/.Xresources</code>也行？）</p>
<p>接着是输入法。我原来准备装搜狗的，但是搜狗因为各种奇奇怪怪的原因（比如说字体找不到，比如说默认装<code>fcitx</code>的时候没有<code>qt4</code>的支持需要额外安装）不能用，在各种坑之后我决定不用它改用sunpinyin+cloud pinyin的组合，试用下来也是相当令人满意的：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> pacman -S fcitx-im
<span class="token function">sudo</span> pacman -S fcitx-configtool
<span class="token function">sudo</span> pacman -S fcitx-sunpinyin fcitx-cloudpinyin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>安装后在<code>~/.xprofile</code>里面加上下列几行启用fcitx</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token builtin class-name">export</span> <span class="token assign-left variable">GTK_IM_MODULE</span><span class="token operator">=</span>fcitx
<span class="token builtin class-name">export</span> <span class="token assign-left variable">QT_IM_MODULE</span><span class="token operator">=</span>fcitx
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">XMODIFIERS</span></span><span class="token operator">=</span><span class="token string">"@im=fcitx"</span>
fcitx -d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>最后一行是我自己加上的，因为似乎由于一些原因fcitx它开机不自启……</p>
<h1 id="配置TeX"><a href="#配置TeX" class="headerlink" title="配置TeX"></a>配置TeX</h1><p>终于可以开始进入正题了，首先安装TeXLive：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> pacman -S texlive-most texlive-langchinese<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>接着安装Vim Plug，在<code>~/.vimrc</code>里面写入自动安装脚本（手动安装亦可）以及一些基本的配置：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">set</span> <span class="token keyword">number</span>
<span class="token keyword">set</span> <span class="token builtin">tabstop</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token keyword">set</span> <span class="token builtin">softtabstop</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token keyword">set</span> <span class="token builtin">shiftwidth</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token keyword">set</span> <span class="token builtin">smartindent</span>

<span class="token builtin">syntax</span> <span class="token keyword">on</span>

<span class="token keyword">if</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token function">glob</span><span class="token punctuation">(</span><span class="token string">'~/.vim/autoload/plug.vim'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">silent</span> <span class="token operator">!</span>curl <span class="token operator">-</span>fLo ~<span class="token operator">/</span><span class="token operator">.</span><span class="token keyword">vim</span><span class="token operator">/</span>autoload<span class="token operator">/</span>plug<span class="token operator">.</span><span class="token keyword">vim</span> <span class="token operator">-</span><span class="token operator">-</span>create<span class="token operator">-</span>dirs
		\ https<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>raw<span class="token operator">.</span>githubusercontent<span class="token operator">.</span><span class="token builtin">com</span><span class="token operator">/</span>junegunn<span class="token operator">/</span><span class="token keyword">vim</span><span class="token operator">-</span>plug<span class="token operator">/</span>master<span class="token operator">/</span>plug<span class="token operator">.</span><span class="token keyword">vim</span>
	<span class="token builtin">autocmd</span> VimEnter <span class="token operator">*</span> PlugInstall <span class="token operator">-</span><span class="token operator">-</span>sync | <span class="token keyword">source</span> $MYVIMRC
<span class="token keyword">endif</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>接着安装所必要的VimTeX插件以及UltiSnips插件并进行相关的配置：</p>
<pre class="line-numbers language-vim" data-language="vim"><code class="language-vim"><span class="token keyword">call</span> plug#<span class="token function">begin</span><span class="token punctuation">(</span><span class="token string">'~/.vim/plugged'</span><span class="token punctuation">)</span>

Plug <span class="token string">'lervag/vimtex'</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>tex_flavor<span class="token operator">=</span><span class="token string">'latex'</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>vimtex_view_method<span class="token operator">=</span><span class="token string">'zathura'</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>vimtex_quickfix_mode<span class="token operator">=</span><span class="token number">0</span>
<span class="token keyword">set</span> conceallevel<span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>tex_conceal<span class="token operator">=</span><span class="token string">'abdmg'</span>

Plug <span class="token string">'sirver/ultisnips'</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>UltiSnipsExpandTrigger<span class="token operator">=</span><span class="token string">'&lt;tab>'</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>UltiSnipsJumpForwardTrigger<span class="token operator">=</span><span class="token string">'&lt;tab>'</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>UltiSnipsJumpBackwardTrigger<span class="token operator">=</span><span class="token string">'&lt;s-tab>'</span>
<span class="token keyword">let</span> g<span class="token punctuation">:</span>UltiSnipsSnippetDirectories<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'mysnippets'</span><span class="token punctuation">]</span>

<span class="token keyword">call</span> plug#<span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>安装Zathura作为PDF阅读器：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> pacman -S zathura zathura-pdf-mupdf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>我查到Manjaro i3终端默认的背景色是<code>#222D31</code>，因此在<code>~/.config/zathura/zathurarc</code>里面写入</p>
<pre class="line-numbers language-none"><code class="language-none">set default-bg &quot;#222D31&quot;
set recolor &quot;true&quot;
set recolor-lightcolor &quot;#222D31&quot;
set recolor-darkcolor &quot;#FFFFFF&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>这样Zathura打开白色的pdf文档的时候就会自动重新着色，完成了色调上的统一。</p>
<p>Vimtex默认使用<code>latexmk</code>编译，<code>latexmk</code>默认调用<code>pdflatex</code>。因为要用中文我们希望它调用<code>xelatex</code>，于是在<code>~/.latexmkrc</code>里面加上</p>
<pre class="line-numbers language-none"><code class="language-none">$pdf_mode &#x3D; 1;
$pdflatex &#x3D; &#39;xelatex --shell-escape %O %S&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>现在随便打开一个tex文档，打出<code>\ll</code>，预览就冒出来了，非常方便。</p>
<h1 id="配置Snippets"><a href="#配置Snippets" class="headerlink" title="配置Snippets"></a>配置Snippets</h1><p>我基本上复制了作者原博客上的大部分snippets的定义。再加上了一些我觉得比较常用的：</p>
<pre class="line-numbers language-none"><code class="language-none">snippet exm &quot;example&quot; bA
\begin&#123;example&#125;
$1
\end&#123;example&#125;
$0
endsnippet

snippet sln &quot;solution&quot; bA
\begin&#123;solution&#125;
$1
\end&#123;solution&#125;
$0
endsnippet

snippet -&gt; &quot;arrow&quot; A
\Rightarrow
endsnippet

snippet sc &quot;since&quot; wA
\because
endsnippet

snippet tf &quot;therefore&quot; wA
\therefore
endsnippet

snippet tx &quot;text&quot; wA
\text&#123;$1&#125;$0
endsnippet

snippet par &quot;()&quot; wA
\left($1\right)$0
endsnippet

snippet pbk &quot;[]&quot; wA
\left[$1\right]$0
endsnippet

snippet pbr &quot;&#123;&#125;&quot; wA
\left\\&#123;$1\right\\&#125;$0
endsnippet

snippet pabs &quot;||&quot; wA
\left|$1\right|$0
endsnippet

snippet enum &quot;enumerate&quot; bwA
\begin&#123;enumerate&#125;
$1
\end&#123;enumerate&#125;
$0
endsnippet

snippet ml &quot;multiline math&quot; bwA
\begin&#123;gather*&#125;
$1
\end&#123;gather*&#125;
$0
endsnippet<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>笔记源文件的preamable定义如下，使用<code>fleqn</code>选项对所有方程进行左对齐，并定义<code>example</code>和<code>solution</code>环境方便记例题和解答：</p>
<pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\documentclass</span><span class="token punctuation">[</span>fleqn<span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token keyword">ctexart</span><span class="token punctuation">&#125;</span>

<span class="token function selector">\usepackage</span><span class="token punctuation">&#123;</span><span class="token keyword">amsthm</span><span class="token punctuation">&#125;</span>
<span class="token function selector">\usepackage</span><span class="token punctuation">&#123;</span><span class="token keyword">amsmath</span><span class="token punctuation">&#125;</span>
<span class="token function selector">\usepackage</span><span class="token punctuation">&#123;</span><span class="token keyword">amssymb</span><span class="token punctuation">&#125;</span>
<span class="token function selector">\usepackage</span><span class="token punctuation">&#123;</span><span class="token keyword">tikz</span><span class="token punctuation">&#125;</span>

<span class="token function selector">\newtheorem*</span><span class="token punctuation">&#123;</span>solution<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>解<span class="token punctuation">&#125;</span>
<span class="token function selector">\newtheorem</span><span class="token punctuation">&#123;</span>example<span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span>例<span class="token punctuation">&#125;</span><span class="token punctuation">[</span>subsection<span class="token punctuation">]</span>

<span class="token function selector">\begin</span><span class="token punctuation">&#123;</span><span class="token keyword">document</span><span class="token punctuation">&#125;</span>
	<span class="token function selector">\maketitle</span>
	...
<span class="token function selector">\end</span><span class="token punctuation">&#123;</span><span class="token keyword">document</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>最后的效果如下：</p>
<p><img src="https://s2.ax1x.com/2020/03/02/3RRrp6.png" alt="3RRrp6.png"></p>
<p>成果：</p>
<p><img src="https://s2.ax1x.com/2020/03/02/3Rojqf.png" alt="3Rojqf.png"></p>
<p>对比手写版：</p>
<p><img src="https://s2.ax1x.com/2020/03/02/3Ro6PJ.jpg" alt="3Ro6PJ.jpg"></p>
<p>是不是看起来还不错？</p>
<h1 id="使用感受"><a href="#使用感受" class="headerlink" title="使用感受"></a>使用感受</h1><h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><ul>
<li>格式内容分离，便于重新排版与整理</li>
<li>字体统一美观（自己手写的字实在是太丑了哇）</li>
<li>例题的自动编号很赞！</li>
</ul>
<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><ul>
<li><p>Vim原来就有两个常用的模式，输入法的使用又增加了一个模式。来回shift切换打断了编辑的流畅性，降低了效率。尤其是很多时候输入法还没切回英文就<code>jj</code>一下或者切片段，结果还要删掉，按shift，然后重新打，有的时候着实糟心。</p>
</li>
<li><p>Snippets多固然增加了效率，但是也增加了记忆的负担。对于我这种新手来说，过多的snippets只是把打LaTeX的时间转换成回忆用哪个snippet比较好的时间，一下子增加太多snippets也会降低效率。</p>
</li>
<li><p>错字的存在。搜狗输入法对于偶尔的打错具有自动修正的功能，但是无论是谷歌拼音还是sunpinyin在这方面都不行，加上很多时候这些输入法的选词并不智能，一个个看过来选词其实也是非常耗费时间的。</p>
</li>
<li><p>还是错字，例如“已知”错打成“一直”，英文可以配置spell checker做实时的纠正，这在原文当中也有提到，但是中文目前在这方面还缺乏支持。我听说百度有这方面的接口，但是不知道对于数学笔记专业性这么强的语料效果怎么样。Vim插件我是肯定没找到。</p>
</li>
<li><p>笔记的结构比较松散，在笔记本上我们可以拿箭头划来划去，有旁注也可以轻松插入，但是这在LaTeX当中绝非易事。很多时候数学笔记的格式很容易让人陷入纠结，比如说我乱打的一段</p>
<blockquote>
<p>设$y=kx+b,\quad (k\neq 0)$</p>
<p>$\Rightarrow x=\frac{y-b}{k}$又因为已知$k=\tan \alpha$…</p>
</blockquote>
<p>这种格式要怎么排版呢？</p>
<ol>
<li>是整个作为一个大的display style math，中文文字作为<code>\text&#123;&#125;</code>镶嵌其中？</li>
<li>还是一行一个display-style math?</li>
<li>还是有中文字的行用inline math，然后纯数学符号的行用display math?</li>
<li>要不要用<code>gather*</code>这种环境？</li>
</ol>
<p>又比如说如下这段：</p>
<blockquote>
<p>$\begin{cases}x=1 \y=2\end{cases}$或$\begin{cases}x=2 \y=1\end{cases}$</p>
</blockquote>
<p>手写起来非常简单，但是LaTeX代码呢？</p>
<pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token equation string">$<span class="token equation-command regex">\begin</span>&#123;cases&#125; x=1 <span class="token equation-command regex">\\</span> y=2 <span class="token equation-command regex">\end</span>&#123;cases&#125;$</span>
或
<span class="token equation string">$<span class="token equation-command regex">\begin</span>&#123;cases&#125; x=2 <span class="token equation-command regex">\\</span> y=1 <span class="token equation-command regex">\end</span>&#123;cases&#125;$</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>一下子复杂了不少，更别说为了中间的“或”字需要输入法切换。这是snippets也难以挽救的低效。</p>
</li>
<li><p>我还没有试过画图。但是这一定是一个天坑。</p>
</li>
<li><p>如果编译失败那几乎是当场去世（悲）</p>
</li>
</ul>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>就我个人体验而言，用LaTeX记笔记虽然能够达到非常高的排版质量，但是并没有传说中的那么高效（尤其是在使用中文的背景之下）。用LaTeX整理笔记自然是极好的，但是用LaTeX在课堂上实时记笔记绝对属于一大作死行为（更别说你也不知道老师收不收LaTeX记得笔记对不？）</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>


<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chengyuan Ma</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  <script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'none'
      },
      options: {
        renderActions: {
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              const target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js';
    script.defer = true;
    document.head.appendChild(script);
  } else {
    MathJax.startup.document.state(0);
    MathJax.typesetClear();
    MathJax.texReset();
    MathJax.typeset();
  }
</script>



</body>
</html>
